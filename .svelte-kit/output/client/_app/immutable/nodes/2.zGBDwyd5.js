import{i as I,g as B,e as L,s as U,c as J}from"../chunks/BfTtFuzB.js";import"../chunks/DsnmJJEf.js";import{aw as q,aq as O,y as f,au as i,x as u,ar as P,as as l,at as n,M as c,z as C,av as F,ax as Q,u as R,ay as V,Q as A,az as M,aA as G}from"../chunks/Mdsrn-sT.js";import{i as T}from"../chunks/DaqNudQJ.js";import{g as N}from"../chunks/4LF6yYm1.js";const K=async({fetch:t})=>{try{const e=await t("/flowbuilder/flows");if(!e.ok)throw e.headers.get("content-type")?.includes("text/html")?new Error("Backend service unavailable (received HTML error page)"):new Error(`Failed to load flows: ${e.statusText}`);return{flows:(await e.json()).flows||[]}}catch(e){console.error("Failed to load flows:",e);let a;return I(e)?a="Cannot connect to backend service":a=B(e),{flows:[],error:a}}},ue=Object.freeze(Object.defineProperty({__proto__:null,load:K},Symbol.toStringTag,{value:"Module"}));var W=(t,e)=>e.onCreate?.(),X=f('<div class="empty-state svelte-fcx454"><p>No flows yet. Create your first flow to get started.</p></div>'),Y=(t,e,a)=>e.onFlowClick?.(c(a).id),Z=f('<p class="description svelte-fcx454"> </p>'),ee=f('<button class="flow-card svelte-fcx454"><h3 class="svelte-fcx454"> </h3> <!> <span> </span></button>'),te=f('<div class="flow-grid svelte-fcx454"></div>'),ae=f('<div class="flow-list svelte-fcx454"><header class="svelte-fcx454"><h2>Flows</h2> <button aria-label="Create New Flow">Create New Flow</button></header> <!></div>');function se(t,e){O(e,!0);var a=ae(),o=l(a),p=i(l(o),2);p.__click=[W,e],n(o);var E=i(o,2);{var g=d=>{var v=X();u(d,v)},x=d=>{var v=te();L(v,21,()=>e.flows,_=>_.id,(_,w)=>{var s=ee();s.__click=[Y,e,w];var r=l(s),h=l(r,!0);n(r);var b=i(r,2);{var z=S=>{var $=Z(),D=l($,!0);n($),C(()=>F(D,c(w).description)),u(S,$)};T(b,S=>{c(w).description&&S(z)})}var j=i(b,2),H=l(j,!0);n(j),n(s),C(()=>{F(h,c(w).name),U(j,1,`runtime-state ${c(w).runtime_state??""}`,"svelte-fcx454"),F(H,c(w).runtime_state)}),u(_,s)}),n(v),u(d,v)};T(E,d=>{e.flows.length===0?d(g):d(x,!1)})}n(a),u(t,a),P()}q(["click"]);const m="/flowbuilder/flows";class y extends Error{constructor(e,a,o){super(e),this.statusCode=a,this.details=o,this.name="FlowApiError"}}function k(t){return{...t,nodes:t.nodes||[],connections:t.connections||[],runtime_state:t.runtime_state}}const oe={async createFlow(t){const e=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const o=await e.json().catch(()=>({}));throw new y(`Failed to create flow: ${e.statusText}`,e.status,o)}const a=await e.json();return k(a)},async listFlows(){const t=await fetch(m);if(!t.ok)throw new y(`Failed to list flows: ${t.statusText}`,t.status);return(await t.json()).flows.map(k)},async getFlow(t){const e=await fetch(`${m}/${t}`);if(!e.ok)throw new y(`Failed to get flow: ${e.statusText}`,e.status);const a=await e.json();return k(a)},async updateFlow(t,e){const a=await fetch(`${m}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){const p=await a.json().catch(()=>({}));throw new y(`Failed to update flow: ${a.statusText}`,a.status,p)}const o=await a.json();return k(o)},async deleteFlow(t){const e=await fetch(`${m}/${t}`,{method:"DELETE"});if(!e.ok)throw new y(`Failed to delete flow: ${e.statusText}`,e.status)}};var re=f('<div class="connectivity-banner svelte-1uha8ag"><strong class="svelte-1uha8ag">⚠️ Backend Not Available</strong> <p class="svelte-1uha8ag"> </p> <p class="help-text svelte-1uha8ag">Please ensure your backend service is running. Check the README for setup instructions.</p></div>'),ne=f('<div class="error-banner svelte-1uha8ag"><strong class="svelte-1uha8ag">Error:</strong> </div>'),le=f('<main class="svelte-1uha8ag"><div class="page-header svelte-1uha8ag"><h1 class="svelte-1uha8ag">Visual Flow Builder</h1> <p class="svelte-1uha8ag">Create and manage semantic stream processing flows</p></div> <!> <!> <!></main>');function fe(t,e){O(e,!0);let a=M(null),o=M("");Q(async()=>{const s=await J();A(a,s.healthy,!0),A(o,s.message,!0)});async function p(){try{const s=await oe.createFlow({name:`Flow ${new Date().toISOString()}`,description:"New flow created from UI"});await N(`/flows/${s.id}`)}catch(s){console.error("Failed to create flow:",s);const r=B(s);alert(`Failed to create flow: ${r}`)}}function E(s){N(`/flows/${s}`)}var g=le();R(s=>{V.title="SemStreams - Flow Builder"});var x=i(l(g),2);{var d=s=>{var r=re(),h=i(l(r),2),b=l(h,!0);n(h),G(2),n(r),C(()=>F(b,c(o))),u(s,r)};T(x,s=>{c(a)===!1&&s(d)})}var v=i(x,2);{var _=s=>{var r=ne(),h=i(l(r));n(r),C(()=>F(h,` ${e.data.error??""}`)),u(s,r)};T(v,s=>{e.data.error&&c(a)!==!1&&s(_)})}var w=i(v,2);se(w,{get flows(){return e.data.flows},onCreate:p,onFlowClick:E}),n(g),u(t,g),P()}export{fe as component,ue as universal};
