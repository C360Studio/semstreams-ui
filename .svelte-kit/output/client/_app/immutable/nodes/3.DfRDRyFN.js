import{H as Lt,b as Bt,g as Ut}from"../chunks/Nne6mvNZ.js";import{aw as Wt,h as Yt,a2 as Ot,ae as Jt,D as Ke,S as oe,aV as ht,aW as We,v as It,d as t,aX as ct,O as c,aY as Ze,P as d,V as s,ab as mt,ac as Xt,W as a,R as i,aZ as Ye,Y as we,Z as ke,aa as ue,T as n,a8 as he,aS as U,Q as V,a_ as Kt,a1 as Fe,X as R,a$ as tt,b0 as Qe,_ as ze,aB as Te,aQ as Zt,b1 as Gt,b2 as gt,b3 as bt,a9 as Qt,aU as $t}from"../chunks/BkwaiKXi.js";import"../chunks/DsnmJJEf.js";import{i as M}from"../chunks/BnpdicBt.js";import{a as ea,S as ta,s as J,b as Le,r as at,c as ut,d as aa,i as ra,e as sa,f as lt}from"../chunks/CvlBOBPg.js";import{r as Pt,p as be,s as dt,b as $e}from"../chunks/Ud_oaDXL.js";import{a as na,u as wt,H as nt,P as ot,B as oa,g as la,S as ia}from"../chunks/0sAz7CIx.js";import{e as Se}from"../chunks/C9UW2KHr.js";import{s as Ee,c as pt}from"../chunks/vE4479mo.js";import"../chunks/C3nM0Ame.js";function At(o,e,r=e){Wt(o,"change",l=>{var v=l?o.defaultChecked:o.checked;r(v)}),(Yt&&o.defaultChecked!==o.checked||Ot(e)==null)&&r(o.checked),Jt(()=>{var l=e();o.checked=!!l})}function va(o,e){throw Ke&&(isNaN(o)||o<400||o>599)?new Error(`HTTP error status codes must be between 400 and 599 ‚Äî ${o} is invalid`):new Lt(o,e)}const da=!1,ca=async({params:o,fetch:e})=>{const r=await e(`/flowbuilder/flows/${o.id}`);if(!r.ok)throw va(r.status,`Flow not found: ${o.id}`);const l=await r.json();return{flow:{...l,nodes:l.nodes||[],connections:l.connections||[]}}},$o=Object.freeze(Object.defineProperty({__proto__:null,load:ca,ssr:da},Symbol.toStringTag,{value:"Module"}));var ua=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],fa=["difference","intersection","symmetricDifference","union"],xt=!1;class ft extends Set{#a=new Map;#e=oe(0);#t=oe(0);#n=ht||-1;constructor(e){if(super(),Ke&&(e=new Set(e),We(this.#e,"SvelteSet version"),We(this.#t,"SvelteSet.size")),e){for(var r of e)super.add(r);this.#t.v=super.size}xt||this.#s()}#r(e){return ht===this.#n?oe(e):It(e)}#s(){xt=!0;var e=ft.prototype,r=Set.prototype;for(const l of ua)e[l]=function(...v){return t(this.#e),r[l].apply(this,v)};for(const l of fa)e[l]=function(...v){t(this.#e);var y=r[l].apply(this,v);return new ft(y)}}has(e){var r=super.has(e),l=this.#a,v=l.get(e);if(v===void 0){if(!r)return t(this.#e),!1;v=this.#r(!0),Ke&&We(v,`SvelteSet has(${ct(e)})`),l.set(e,v)}return t(v),r}add(e){return super.has(e)||(super.add(e),c(this.#t,super.size),Ze(this.#e)),this}delete(e){var r=super.delete(e),l=this.#a,v=l.get(e);return v!==void 0&&(l.delete(e),c(v,!1)),r&&(c(this.#t,super.size),Ze(this.#e)),r}clear(){if(super.size!==0){super.clear();var e=this.#a;for(var r of e.values())c(r,!1);e.clear(),c(this.#t,0),Ze(this.#e)}}keys(){return this.values()}values(){return t(this.#e),super.values()}entries(){return t(this.#e),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return t(this.#t)}}class it extends Map{#a=new Map;#e=oe(0);#t=oe(0);#n=ht||-1;constructor(e){if(super(),Ke&&(e=new Map(e),We(this.#e,"SvelteMap version"),We(this.#t,"SvelteMap.size")),e){for(var[r,l]of e)super.set(r,l);this.#t.v=super.size}}#r(e){return ht===this.#n?oe(e):It(e)}has(e){var r=this.#a,l=r.get(e);if(l===void 0){var v=super.get(e);if(v!==void 0)l=this.#r(0),Ke&&We(l,`SvelteMap get(${ct(e)})`),r.set(e,l);else return t(this.#e),!1}return t(l),!0}forEach(e,r){this.#s(),super.forEach(e,r)}get(e){var r=this.#a,l=r.get(e);if(l===void 0){var v=super.get(e);if(v!==void 0)l=this.#r(0),Ke&&We(l,`SvelteMap get(${ct(e)})`),r.set(e,l);else{t(this.#e);return}}return t(l),super.get(e)}set(e,r){var l=this.#a,v=l.get(e),y=super.get(e),w=super.set(e,r),C=this.#e;if(v===void 0)v=this.#r(0),Ke&&We(v,`SvelteMap get(${ct(e)})`),l.set(e,v),c(this.#t,super.size),Ze(C);else if(y!==r){Ze(v);var F=C.reactions===null?null:new Set(C.reactions),A=F===null||!v.reactions?.every(S=>F.has(S));A&&Ze(C)}return w}delete(e){var r=this.#a,l=r.get(e),v=super.delete(e);return l!==void 0&&(r.delete(e),c(this.#t,super.size),c(l,-1),Ze(this.#e)),v}clear(){if(super.size!==0){super.clear();var e=this.#a;c(this.#t,0);for(var r of e.values())c(r,-1);Ze(this.#e),e.clear()}}#s(){t(this.#e);var e=this.#a;if(this.#t.v!==e.size){for(var r of super.keys())if(!e.has(r)){var l=this.#r(0);Ke&&We(l,`SvelteMap get(${ct(r)})`),e.set(r,l)}}for([,l]of this.#a)t(l)}keys(){return t(this.#e),super.keys()}values(){return this.#s(),super.values()}entries(){return this.#s(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return t(this.#t),super.size}}var ga=d("<button><!></button>");function _t(o,e){let r=Pt(e,["$$slots","$$events","$$legacy","class","bgColor","bgColorHover","color","colorHover","borderColor","onclick","children"]);var l=ga();ea(l,y=>({type:"button",onclick:e.onclick,class:["svelte-flow__controls-button",e.class],...r,[ta]:y}),[()=>({"--xy-controls-button-background-color-props":e.bgColor,"--xy-controls-button-background-color-hover-props":e.bgColorHover,"--xy-controls-button-color-props":e.color,"--xy-controls-button-color-hover-props":e.colorHover,"--xy-controls-button-border-color-props":e.borderColor})]);var v=s(l);mt(v,()=>e.children??Xt),a(l),i(o,l)}var _a=Ye('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"></path></svg>');function ma(o){var e=_a();i(o,e)}var ha=Ye('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 5"><path d="M0 0h32v4.2H0z"></path></svg>');function ba(o){var e=ha();i(o,e)}var pa=Ye('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 30"><path d="M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"></path></svg>');function ya(o){var e=pa();i(o,e)}var wa=Ye('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 32"><path d="M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"></path></svg>');function ka(o){var e=wa();i(o,e)}var Sa=Ye('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 32"><path d="M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"></path></svg>');function xa(o){var e=Sa();i(o,e)}var Ca=d("<!> <!>",1),qa=d("<!> <!> <!> <!> <!> <!>",1);function za(o,e){we(e,!0);let r=be(e,"position",3,"bottom-left"),l=be(e,"orientation",3,"vertical"),v=be(e,"showZoom",3,!0),y=be(e,"showFitView",3,!0),w=be(e,"showLock",3,!0),C=Pt(e,["$$slots","$$events","$$legacy","position","orientation","showZoom","showFitView","showLock","style","class","buttonBgColor","buttonBgColorHover","buttonColor","buttonColorHover","buttonBorderColor","fitViewOptions","children","before","after"]),F=U(wt);const A={bgColor:e.buttonBgColor,bgColorHover:e.buttonBgColorHover,color:e.buttonColor,colorHover:e.buttonColorHover,borderColor:e.buttonBorderColor};let S=U(()=>t(F).nodesDraggable||t(F).nodesConnectable||t(F).elementsSelectable),u=U(()=>t(F).viewport.zoom<=t(F).minZoom),j=U(()=>t(F).viewport.zoom>=t(F).maxZoom),H=U(()=>t(F).ariaLabelConfig),g=U(()=>l()==="horizontal"?"horizontal":"vertical");const h=()=>{t(F).zoomIn()},m=()=>{t(F).zoomOut()},E=()=>{t(F).fitView(e.fitViewOptions)},q=()=>{let P=!t(S);t(F).nodesDraggable=P,t(F).nodesConnectable=P,t(F).elementsSelectable=P};{let P=U(()=>["svelte-flow__controls",t(g),e.class]);na(o,dt({get class(){return t(P)},get position(){return r()},"data-testid":"svelte-flow__controls",get"aria-label"(){return t(H)["controls.ariaLabel"]},get style(){return e.style}},()=>C,{children:(x,_)=>{var O=qa(),Y=ue(O);{var L=T=>{var I=he(),N=ue(I);mt(N,()=>e.before),i(T,I)};M(Y,T=>{e.before&&T(L)})}var G=n(Y,2);{var ie=T=>{var I=Ca(),N=ue(I);_t(N,dt({onclick:h,class:"svelte-flow__controls-zoomin",get title(){return t(H)["controls.zoomIn.ariaLabel"]},get"aria-label"(){return t(H)["controls.zoomIn.ariaLabel"]},get disabled(){return t(j)}},()=>A,{children:($,ce)=>{ma($)},$$slots:{default:!0}}));var Z=n(N,2);_t(Z,dt({onclick:m,class:"svelte-flow__controls-zoomout",get title(){return t(H)["controls.zoomOut.ariaLabel"]},get"aria-label"(){return t(H)["controls.zoomOut.ariaLabel"]},get disabled(){return t(u)}},()=>A,{children:($,ce)=>{ba($)},$$slots:{default:!0}})),i(T,I)};M(G,T=>{v()&&T(ie)})}var ee=n(G,2);{var z=T=>{_t(T,dt({class:"svelte-flow__controls-fitview",onclick:E,get title(){return t(H)["controls.fitView.ariaLabel"]},get"aria-label"(){return t(H)["controls.fitView.ariaLabel"]}},()=>A,{children:(I,N)=>{ya(I)},$$slots:{default:!0}}))};M(ee,T=>{y()&&T(z)})}var k=n(ee,2);{var D=T=>{_t(T,dt({class:"svelte-flow__controls-interactive",onclick:q,get title(){return t(H)["controls.interactive.ariaLabel"]},get"aria-label"(){return t(H)["controls.interactive.ariaLabel"]}},()=>A,{children:(I,N)=>{var Z=he(),$=ue(Z);{var ce=p=>{xa(p)},Q=p=>{ka(p)};M($,p=>{t(S)?p(ce):p(Q,!1)})}i(I,Z)},$$slots:{default:!0}}))};M(k,T=>{w()&&T(D)})}var K=n(k,2);{var re=T=>{var I=he(),N=ue(I);mt(N,()=>e.children),i(T,I)};M(K,T=>{e.children&&T(re)})}var b=n(K,2);{var f=T=>{var I=he(),N=ue(I);mt(N,()=>e.after),i(T,I)};M(b,T=>{e.after&&T(f)})}i(x,O)},$$slots:{default:!0}}))}ke()}var Ge;(function(o){o.Lines="lines",o.Dots="dots",o.Cross="cross"})(Ge||(Ge={}));var Ea=Ye("<circle></circle>");function Ta(o,e){var r=Ea();V(()=>{J(r,"cx",e.radius),J(r,"cy",e.radius),J(r,"r",e.radius),Ee(r,0,pt(["svelte-flow__background-pattern","dots",e.class]))}),i(o,r)}var Ra=Ye("<path></path>");function Da(o,e){we(e,!0);var r=Ra();V(()=>{J(r,"stroke-width",e.lineWidth),J(r,"d",`M${e.dimensions[0]/2} 0 V${e.dimensions[1]} M0 ${e.dimensions[1]/2} H${e.dimensions[0]}`),Ee(r,0,pt(["svelte-flow__background-pattern",e.variant,e.class]))}),i(o,r),ke()}const Fa={[Ge.Dots]:1,[Ge.Lines]:1,[Ge.Cross]:6};var ja=Ye('<svg data-testid="svelte-flow__background"><pattern patternUnits="userSpaceOnUse"><!></pattern><rect x="0" y="0" width="100%" height="100%"></rect></svg>');function Ma(o,e){we(e,!0);let r=be(e,"variant",19,()=>Ge.Dots),l=be(e,"gap",3,20),v=be(e,"lineWidth",3,1),y=U(wt),w=U(()=>r()===Ge.Dots),C=U(()=>r()===Ge.Cross),F=U(()=>Array.isArray(l())?l():[l(),l()]),A=U(()=>`background-pattern-${t(y).flowId}-${e.id??""}`),S=U(()=>[t(F)[0]*t(y).viewport.zoom||1,t(F)[1]*t(y).viewport.zoom||1]),u=U(()=>(e.size??Fa[r()])*t(y).viewport.zoom),j=U(()=>t(C)?[t(u),t(u)]:t(S)),H=U(()=>t(w)?[t(u)/2,t(u)/2]:[t(j)[0]/2,t(j)[1]/2]);var g=ja();let h;var m=s(g),E=s(m);{var q=_=>{{let O=U(()=>t(u)/2);Ta(_,{get radius(){return t(O)},get class(){return e.patternClass}})}},P=_=>{Da(_,{get dimensions(){return t(j)},get variant(){return r()},get lineWidth(){return v()},get class(){return e.patternClass}})};M(E,_=>{t(w)?_(q):_(P,!1)})}a(m);var x=n(m);a(g),V(_=>{Ee(g,0,pt(["svelte-flow__background","svelte-flow__container",e.class])),h=Le(g,"",h,_),J(m,"id",t(A)),J(m,"x",t(y).viewport.x%t(S)[0]),J(m,"y",t(y).viewport.y%t(S)[1]),J(m,"width",t(S)[0]),J(m,"height",t(S)[1]),J(m,"patternTransform",`translate(-${t(H)[0]},-${t(H)[1]})`),J(x,"fill",`url(#${t(A)})`)},[()=>({"--xy-background-color-props":e.bgColor,"--xy-background-pattern-color-props":e.patternColor})]),i(o,g),ke()}function Oa(){const o=U(wt),e=U(()=>t(o).domNode),r=U(()=>t(o).updateNodeInternals),l=Kt("svelteflow__node_id");return y=>{if(!y&&!l)throw new Error("When using outside of a node, you must provide an id.");const w=y?Array.isArray(y)?y:[y]:[l],C=new Map;w.forEach(F=>{const A=t(e)?.querySelector(`.svelte-flow__node[data-id="${F}"]`);A&&C.set(F,{id:F,nodeElement:A,force:!0})}),requestAnimationFrame(()=>t(r)(C))}}const Ia={nats_stream:"var(--port-pattern-stream)",nats_request:"var(--port-pattern-request)",kv_watch:"var(--port-pattern-watch)",network:"var(--port-pattern-api)",file:"var(--port-pattern-file)"},Ct={required:"solid",optional:"dashed"},Pa={nats_stream:"arrow-path-rounded-square",nats_request:"arrow-path",kv_watch:"eye",network:"server",file:"document-text"};function qt(o){let e;switch(o.pattern){case"stream":e="nats_stream";break;case"request":e="nats_request";break;case"watch":e="kv_watch";break;case"api":e="network";break;default:o.connection_id?.startsWith("file://")?e="file":e="network"}const r=Ia[e],l=o.required?Ct.required:Ct.optional,v=Pa[e],y=e.replace("_"," "),w=o.direction==="input"?"Input":"Output",C=o.required?"required":"optional",F=`${y} ${w}: ${o.name} (${C})`,A=["port-handle",`port-${e}`,`port-${l}`];return{color:r,borderPattern:l,iconName:v,ariaLabel:F,cssClasses:A}}const Aa={robotics:{color:"var(--domain-robotics)",label:"Robotics",description:"Autonomous vehicles and MAVLink processing"},semantic:{color:"var(--domain-semantic)",label:"Semantic Processing",description:"Knowledge graphs, rules, and reasoning"},network:{color:"var(--domain-network)",label:"Network I/O",description:"Data ingestion and output (UDP, WebSocket, HTTP)"},storage:{color:"var(--domain-storage)",label:"Storage",description:"Data persistence and retrieval"},telemetry:{color:"var(--domain-telemetry)",label:"Telemetry",description:"Metrics and observability"},geospatial:{color:"var(--domain-geospatial)",label:"Geospatial",description:"GIS, mapping, and location services"},media:{color:"var(--domain-media)",label:"Media",description:"Video, audio, and image processing"},integration:{color:"var(--domain-integration)",label:"Integration",description:"External system connectors"}};function Ht(o){return Aa[o]?.color||"var(--ui-border-subtle)"}var Ha=d("<!> <!> <!> <!>",1),Na=d('<div class="custom-flow-node svelte-102d1ml"><!>  <!> <!> <div class="node-content svelte-102d1ml"><div class="node-label svelte-102d1ml"> </div> <div class="port-summary svelte-102d1ml"> </div></div></div>');function Va(o,e){we(e,!0);const r=e.id,l=U(()=>e.data),v=Oa(),y=U(()=>Ht(t(l).node.type||"network")),w=U(()=>[...t(l).input_ports||[],...t(l).output_ports||[]]);Fe(()=>{t(w).length>0&&(console.log(`[CustomFlowNode ${r}] Port handles:`,t(w).map(E=>({name:E.name,direction:E.direction,type:E.pattern,required:E.required}))),v(r))});var C=Na(),F=s(C);{var A=E=>{var q=Ha(),P=ue(q);nt(P,{type:"target",get position(){return ot.Left},id:"nats_output",class:"nodrag","data-port-name":"nats_output","data-direction":"input"});var x=n(P,2);nt(x,{type:"target",get position(){return ot.Left},id:"mavlink_input",class:"nodrag","data-port-name":"mavlink_input","data-direction":"input"});var _=n(x,2);nt(_,{type:"source",get position(){return ot.Right},id:"nats_output",class:"nodrag","data-port-name":"nats_output","data-direction":"output"});var O=n(_,2);nt(O,{type:"source",get position(){return ot.Right},id:"mavlink_input",class:"nodrag","data-port-name":"mavlink_input","data-direction":"output"}),i(E,q)};M(F,E=>{t(w).length===0&&E(A)})}var S=n(F,2);Se(S,19,()=>t(w).filter(E=>E.direction==="input"),E=>E.name,(E,q,P)=>{const x=U(()=>qt(t(q))),_=U(()=>`${t(q).name} (${t(q).required?"required":"optional"}): ${t(q).description||t(q).connection_id}`);{let O=U(()=>50+t(P)*35),Y=U(()=>t(x).color);nt(E,{type:"target",get position(){return ot.Left},get id(){return t(q).name},class:"port-handle port-handle-input",get"data-required"(){return t(q).required},get"data-port-name"(){return t(q).name},get"data-tooltip"(){return t(_)},get style(){return`top: ${t(O)??""}px; left: -6px; --port-color: ${t(Y)??""};`}})}});var u=n(S,2);Se(u,19,()=>t(w).filter(E=>E.direction==="output"),E=>E.name,(E,q,P)=>{const x=U(()=>qt(t(q))),_=U(()=>`${t(q).name} (${t(q).required?"required":"optional"}): ${t(q).description||t(q).connection_id}`);{let O=U(()=>50+t(P)*35),Y=U(()=>t(x).color);nt(E,{type:"source",get position(){return ot.Right},get id(){return t(q).name},class:"port-handle port-handle-output",get"data-required"(){return t(q).required},get"data-port-name"(){return t(q).name},get"data-tooltip"(){return t(_)},get style(){return`top: ${t(O)??""}px; right: -6px; --port-color: ${t(Y)??""};`}})}});var j=n(u,2),H=s(j),g=s(H,!0);a(H);var h=n(H,2),m=s(h);a(h),a(j),a(C),V((E,q)=>{J(C,"data-node-id",r),J(C,"data-node-type",t(l).node.type),Le(C,`border-left: var(--canvas-node-domain-accent-width) solid ${t(y)??""};`),R(g,t(l).label),R(m,`${E??""} inputs, ${q??""} outputs`)},[()=>t(w).filter(E=>E.direction==="input").length,()=>t(w).filter(E=>E.direction==="output").length]),i(o,C),ke()}var La=Ye("<g><!></g>");function yt(o,e){we(e,!0),console.log("[ConnectionLine] Rendering edge:",e.id,"source:",e.sourceX,e.sourceY,"target:",e.targetX,e.targetY);const r=U(()=>()=>{const u=["connection-line"];return e.data?.source&&u.push(`edge-${e.data.source}`),e.data?.validationState&&u.push(`edge-${e.data.validationState}`),u.join(" ")}),l=U(()=>la({sourceX:e.sourceX,sourceY:e.sourceY,sourcePosition:e.sourcePosition,targetX:e.targetX,targetY:e.targetY,targetPosition:e.targetPosition})),v=U(()=>tt(t(l),3)),y=U(()=>t(v)[0]),w=U(()=>()=>{if(e.data?.validationState)switch(e.data.validationState){case"error":return"var(--status-error)";case"warning":return"var(--status-warning)";case"valid":return"var(--ui-interactive-primary)";default:return}}),C=U(()=>()=>{if(!e.data?.validationState)return 2;switch(e.data.validationState){case"error":return 3;case"warning":return 2;default:return 2}}),F=U(()=>e.data?.source==="auto"?"5, 5":void 0);var A=La(),S=s(A);{let u=U(()=>t(w)()||"#b1b1b7"),j=U(()=>t(C)()),H=U(()=>t(F));oa(S,{get path(){return t(y)},get markerEnd(){return e.markerEnd},get style(){return`stroke: ${t(u)??""}; stroke-width: ${t(j)??""}; stroke-dasharray: ${t(H)??""};`}})}a(A),V(u=>{Ee(A,0,u,"svelte-u12a0a"),J(A,"data-connection-id",e.id),J(A,"data-source",e.data?.source),J(A,"data-validation-state",e.data?.validationState)},[()=>pt(t(r)())]),i(o,A),ke()}function kt(o,e){return{id:o.id,type:"custom",position:o.position,data:{label:o.name||o.type,node:o,onNodeClick:e},selectable:!0,focusable:!0,draggable:!0,connectable:!0}}function Ba(o){return{id:o.id,type:o.data.node.type,name:o.data.label,position:o.position,config:o.data.node.config}}function St(o){const e={};if(o.source==="auto"&&(e.strokeDasharray="5, 5"),o.validationState)switch(o.validationState){case"error":e.stroke="#dc3545",e.strokeWidth=3;break;case"warning":e.stroke="#ffc107",e.strokeWidth=2;break;case"valid":e.stroke="#0066cc";break}const r=Object.keys(e).length>0?Object.entries(e).map(([l,v])=>`${l}: ${v}`).join("; "):void 0;return{id:o.id,source:o.source_node_id,target:o.target_node_id,sourceHandle:o.source_port,targetHandle:o.target_port,data:{source:o.source,validationState:o.validationState,sourceNodeId:o.source_node_id,sourcePort:o.source_port,targetNodeId:o.target_node_id,targetPort:o.target_port},style:r}}function Ua(o){return{id:o.id,source_node_id:o.source,target_node_id:o.target,source_port:o.sourceHandle||"",target_port:o.targetHandle||""}}function Wa(o,e){return o.map(r=>kt(r,e))}function zt(o){return o.map(Ba)}function Ya(o){return o.map(St)}function Et(o){return o.map(Ua)}var Ja=d("<!> <!>",1),Xa=d('<div id="flow-canvas" class="flow-canvas svelte-5kezjk" role="application" aria-label="Flow canvas for visual flow design"><!></div>');function Ka(o,e){we(e,!0);const r={custom:Va},l={default:yt,manual:yt,auto:yt};let v=be(e,"nodes",31,()=>ze([])),y=be(e,"edges",31,()=>ze([])),w;Fe(()=>{y().length>0&&console.log("[FlowCanvas] Edges:",y().map(g=>({id:g.id,source:g.source,target:g.target,sourceHandle:g.sourceHandle,targetHandle:g.targetHandle})))});function C(g){const m=g.event?.target;if(console.log("[handleNodeClick] Clicked:",{tagName:m?.tagName,classes:m?.className,isHandle:m?.classList?.contains("svelte-flow__handle")}),m?.classList?.contains("svelte-flow__handle")||m?.closest?.(".svelte-flow__handle")){console.log("[handleNodeClick] Handle clicked - ignoring");return}const E=g.node;!E||!E.id||(console.log("[handleNodeClick] Opening config for node:",E.id),e.onNodeClick?.(E.id))}function F(g){return y().some(m=>m.source===g.source&&m.target===g.target&&m.sourceHandle===g.sourceHandle&&m.targetHandle===g.targetHandle)?"Connection already exists between these ports":g.source===g.target?"Cannot connect a component to itself":null}function A(g){if(console.log("[handleConnect] Creating manual connection:",g.source,"‚Üí",g.target),e.runtimeState==="running"||!g.source||!g.target||!g.sourceHandle||!g.targetHandle)return;const h=F(g);if(h){console.log("[handleConnect] Rejected:",h);return}const E={id:`conn_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,source_node_id:g.source,source_port:g.sourceHandle,target_node_id:g.target,target_port:g.targetHandle,source:"manual",validationState:"unknown"},q=St(E);y([...y(),q]),console.log("[handleConnect] ‚úì Manual connection created"),e.onConnectionCreate?.()}function S(g){g.preventDefault(),g.dataTransfer&&(g.dataTransfer.dropEffect="copy")}function u(g){if(g.preventDefault(),!!g.dataTransfer){if(e.runtimeState==="running"){console.warn("Cannot add components while flow is running");return}try{const h=g.dataTransfer.getData("application/json");if(!h)return;const m=JSON.parse(h),E=w.getBoundingClientRect(),q=g.clientX-E.left,P=g.clientY-E.top,_={id:`node_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,type:m.id,name:m.name,position:{x:q,y:P},config:{}},O=kt(_,e.onNodeClick);v([...v(),O])}catch(h){console.error("Failed to add component via drop:",h)}}}var j=Xa(),H=s(j);ia(H,{get nodeTypes(){return r},get edgeTypes(){return l},fitView:!0,nodesDraggable:!0,nodesConnectable:!0,nodeClickDistance:0,onnodeclick:C,onconnect:A,get nodes(){return v()},set nodes(g){v(g)},get edges(){return y()},set edges(g){y(g)},children:(g,h)=>{var m=Ja(),E=ue(m);za(E,{});var q=n(E,2);Ma(q,{}),i(g,m)},$$slots:{default:!0}}),a(j),$e(j,g=>w=g,()=>w),Qe("dragover",j,S),Qe("drop",j,u),i(o,j),ke()}var Za=d('<div class="loading svelte-f0ohny">Loading components...</div>'),Ga=d('<div class="error svelte-f0ohny"> </div>'),Qa=d('<div class="empty svelte-f0ohny"><p class="svelte-f0ohny">Component palette coming soon</p> <p class="empty-hint svelte-f0ohny">Component types will be loaded from the registry</p></div>'),$a=(o,e,r)=>e(t(r)),er=(o,e,r)=>e(o,t(r)),tr=d('<div class="component-card svelte-f0ohny" draggable="true" role="button" tabindex="0"><div class="component-name svelte-f0ohny"> </div> <div class="component-description svelte-f0ohny"> </div> <div class="component-meta svelte-f0ohny"><span class="component-protocol svelte-f0ohny"> </span></div></div>'),ar=d('<div class="category svelte-f0ohny"><div class="category-header svelte-f0ohny"> </div> <div class="component-list svelte-f0ohny"></div></div>'),rr=d('<div class="component-palette svelte-f0ohny"><header class="svelte-f0ohny"><h3 class="svelte-f0ohny">Components</h3></header> <div class="palette-content svelte-f0ohny"><!></div></div>');function sr(o,e){we(e,!0);let r=oe(ze([])),l=oe(!0),v=oe(null);const y=U(()=>{const g=new it;return t(r).forEach(h=>{const m=h.category||"other";g.has(m)||g.set(m,[]),g.get(m).push(h)}),g});Zt(async()=>{try{const g=new AbortController,h=setTimeout(()=>g.abort(),1e4),m=await fetch("/components/types",{signal:g.signal});if(clearTimeout(h),!m.ok)throw new Error(`Failed to fetch components: ${m.statusText}`);const E=await m.json();c(r,Array.isArray(E)?E:[],!0)}catch(g){g instanceof Error?g.name==="AbortError"?c(v,"Request timed out after 10 seconds"):c(v,g.message,!0):c(v,"Error loading components"),console.error("ComponentPalette fetch error:",g)}finally{c(l,!1)}});function w(g,h){g.dataTransfer&&(g.dataTransfer.setData("application/json",JSON.stringify(h)),g.dataTransfer.effectAllowed="copy")}function C(g){e.onAddComponent?.(g)}function F(g,h){(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),e.onAddComponent?.(h))}var A=rr(),S=n(s(A),2),u=s(S);{var j=g=>{var h=Za();i(g,h)},H=g=>{var h=he(),m=ue(h);{var E=P=>{var x=Ga(),_=s(x);a(x),V(()=>R(_,`Error loading components: ${t(v)??""}`)),i(P,x)},q=P=>{var x=he(),_=ue(x);{var O=L=>{var G=Qa();i(L,G)},Y=L=>{var G=he(),ie=ue(G);Se(ie,17,()=>[...t(y)],([ee,z])=>ee,(ee,z)=>{var k=U(()=>tt(t(z),2));let D=()=>t(k)[0],K=()=>t(k)[1];var re=ar(),b=s(re),f=s(b,!0);a(b);var T=n(b,2);Se(T,21,K,I=>I.id,(I,N)=>{const Z=U(()=>Ht(t(N).category||D()));var $=tr();$.__dblclick=[$a,C,N],$.__keydown=[er,F,N];var ce=s($),Q=s(ce,!0);a(ce);var p=n(ce,2),W=s(p,!0);a(p);var te=n(p,2),ae=s(te),se=s(ae,!0);a(ae),a(te),a($),V(()=>{J($,"data-component-id",t(N).id),J($,"data-component-name",t(N).name),J($,"aria-label",`${t(N).name}: ${t(N).description}. Drag to canvas, double-click, or press Enter to add.`),Le($,`border-left: var(--palette-domain-stripe-width) solid ${t(Z)??""};`),R(Q,t(N).name),R(W,t(N).description),R(se,t(N).protocol)}),Qe("dragstart",$,ve=>w(ve,t(N))),i(I,$)}),a(T),a(re),V(()=>R(f,D())),i(ee,re)}),i(L,G)};M(_,L=>{t(r).length===0?L(O):L(Y,!1)},!0)}i(P,x)};M(m,P=>{t(v)?P(E):P(q,!1)},!0)}i(g,h)};M(u,g=>{t(l)?g(j):g(H,!1)})}a(S),a(A),i(o,A),ke()}Te(["dblclick","keydown"]);function Tt(o,e,r,l){if(l&&(e==null||e===""))return{field:o,message:"This field is required",code:"required"};if(e==null||e==="")return null;if(r.type==="int"||r.type==="float"){const v=typeof e=="string"?parseFloat(e):Number(e);if(isNaN(v))return{field:o,message:"Must be a valid number",code:"type"};if(r.minimum!==void 0&&v<r.minimum)return{field:o,message:`Must be >= ${r.minimum}`,code:"min"};if(r.maximum!==void 0&&v>r.maximum)return{field:o,message:`Must be <= ${r.maximum}`,code:"max"}}if(r.type==="enum"&&r.enum){const v=String(e);if(!r.enum.includes(v))return{field:o,message:`Must be one of: ${r.enum.join(", ")}`,code:"enum"}}return r.type==="bool"&&typeof e!="boolean"&&e!=="true"&&e!=="false"?{field:o,message:"Must be true or false",code:"type"}:null}var nr=d('<span class="required svelte-1kcu2mn">*</span>'),or=(o,e,r)=>{e(o.currentTarget.value),r.onChange?.(e())},lr=d('<span class="description svelte-1kcu2mn"> </span>'),ir=d('<span class="error svelte-1kcu2mn" role="alert"> </span>'),vr=d('<div class="field svelte-1kcu2mn"><label class="svelte-1kcu2mn"> <!></label> <input type="text" class="svelte-1kcu2mn"/> <!> <!></div>');function dr(o,e){we(e,!0);let r=be(e,"value",15),l=be(e,"isRequired",3,!1),v=U(()=>r()??"");var y=vr(),w=s(y),C=s(w),F=n(C);{var A=h=>{var m=nr();i(h,m)};M(F,h=>{l()&&h(A)})}a(w);var S=n(w,2);at(S),S.__input=[or,r,e];var u=n(S,2);{var j=h=>{var m=lr(),E=s(m,!0);a(m),V(()=>{J(m,"id",`${e.name??""}-description`),R(E,e.schema.description)}),i(h,m)};M(u,h=>{e.schema.description&&h(j)})}var H=n(u,2);{var g=h=>{var m=ir(),E=s(m,!0);a(m),V(()=>{J(m,"id",`${e.name??""}-error`),R(E,e.error)}),i(h,m)};M(H,h=>{e.error&&h(g)})}a(y),V(()=>{J(w,"for",e.name),R(C,`${e.name??""} `),J(S,"id",e.name),ut(S,t(v)),J(S,"aria-required",l()?"true":void 0),J(S,"aria-invalid",e.error?"true":void 0),J(S,"aria-describedby",e.error?`${e.name}-error`:e.schema.description?`${e.name}-description`:void 0)}),i(o,y),ke()}Te(["input"]);var cr=d('<span class="required svelte-1k679g3">*</span>'),ur=(o,e,r)=>{const l=o.currentTarget.value;e(l===""?void 0:r.schema.type==="float"?parseFloat(l):parseInt(l,10)),r.onChange?.(e())},fr=d('<span class="description svelte-1k679g3"> </span>'),gr=d('<span class="error svelte-1k679g3" role="alert"> </span>'),_r=d('<div class="field svelte-1k679g3"><label class="svelte-1k679g3"> <!></label> <input type="number" class="svelte-1k679g3"/> <!> <!></div>');function mr(o,e){we(e,!0);let r=be(e,"value",15),l=be(e,"isRequired",3,!1),v=U(()=>e.schema.type==="float"?"any":"1"),y=U(()=>r()??"");var w=_r(),C=s(w),F=s(C),A=n(F);{var S=m=>{var E=cr();i(m,E)};M(A,m=>{l()&&m(S)})}a(C);var u=n(C,2);at(u),u.__input=[ur,r,e];var j=n(u,2);{var H=m=>{var E=fr(),q=s(E,!0);a(E),V(()=>{J(E,"id",`${e.name??""}-description`),R(q,e.schema.description)}),i(m,E)};M(j,m=>{e.schema.description&&m(H)})}var g=n(j,2);{var h=m=>{var E=gr(),q=s(E,!0);a(E),V(()=>{J(E,"id",`${e.name??""}-error`),R(q,e.error)}),i(m,E)};M(g,m=>{e.error&&m(h)})}a(w),V(()=>{J(C,"for",e.name),R(F,`${e.name??""} `),J(u,"id",e.name),ut(u,t(y)),J(u,"min",e.schema.minimum),J(u,"max",e.schema.maximum),J(u,"step",t(v)),J(u,"aria-required",l()?"true":void 0),J(u,"aria-invalid",e.error?"true":void 0),J(u,"aria-describedby",e.error?`${e.name}-error`:e.schema.description?`${e.name}-description`:void 0)}),i(o,w),ke()}Te(["input"]);var hr=(o,e,r)=>{e(o.currentTarget.checked),r.onChange?.(e())},br=d('<span class="required svelte-ohz1cs">*</span>'),pr=d('<span class="description svelte-ohz1cs"> </span>'),yr=d('<span class="error svelte-ohz1cs" role="alert"> </span>'),wr=d('<div class="field checkbox-field svelte-ohz1cs"><label class="svelte-ohz1cs"><input type="checkbox" class="svelte-ohz1cs"/> <!></label> <!> <!></div>');function kr(o,e){we(e,!0);let r=be(e,"value",15),l=be(e,"isRequired",3,!1),v=U(()=>r()??!1);var y=wr(),w=s(y),C=s(w);at(C),C.__change=[hr,r,e];var F=n(C),A=n(F);{var S=h=>{var m=br();i(h,m)};M(A,h=>{l()&&h(S)})}a(w);var u=n(w,2);{var j=h=>{var m=pr(),E=s(m,!0);a(m),V(()=>{J(m,"id",`${e.name??""}-description`),R(E,e.schema.description)}),i(h,m)};M(u,h=>{e.schema.description&&h(j)})}var H=n(u,2);{var g=h=>{var m=yr(),E=s(m,!0);a(m),V(()=>{J(m,"id",`${e.name??""}-error`),R(E,e.error)}),i(h,m)};M(H,h=>{e.error&&h(g)})}a(y),V(()=>{J(w,"for",e.name),J(C,"id",e.name),aa(C,t(v)),J(C,"aria-required",l()?"true":void 0),J(C,"aria-invalid",e.error?"true":void 0),J(C,"aria-describedby",e.error?`${e.name}-error`:e.schema.description?`${e.name}-description`:void 0),R(F,` ${e.name??""} `)}),i(o,y),ke()}Te(["change"]);var Sr=d('<span class="required svelte-xd7yoz">*</span>'),xr=(o,e,r)=>{e(o.currentTarget.value),r.onChange?.(e())},Cr=d("<option></option>"),qr=d("<option> </option>"),zr=d('<span class="description svelte-xd7yoz"> </span>'),Er=d('<span class="error svelte-xd7yoz" role="alert"> </span>'),Tr=d('<div class="field svelte-xd7yoz"><label class="svelte-xd7yoz"> <!></label> <select class="svelte-xd7yoz"><!><!></select> <!> <!></div>');function Rr(o,e){we(e,!0);let r=be(e,"value",15),l=be(e,"isRequired",3,!1),v=U(()=>e.schema.enum||[]),y=U(()=>r()??"");var w=Tr(),C=s(w),F=s(C),A=n(F);{var S=x=>{var _=Sr();i(x,_)};M(A,x=>{l()&&x(S)})}a(C);var u=n(C,2);u.__change=[xr,r,e];var j=s(u);{var H=x=>{var _=Cr();_.value=_.__value="",i(x,_)};M(j,x=>{t(v).length>0&&!r()&&!l()&&x(H)})}var g=n(j);Se(g,16,()=>t(v),x=>x,(x,_)=>{var O=qr(),Y=s(O,!0);a(O);var L={};V(()=>{R(Y,_),L!==(L=_)&&(O.value=(O.__value=_)??"")}),i(x,O)}),a(u);var h;ra(u);var m=n(u,2);{var E=x=>{var _=zr(),O=s(_,!0);a(_),V(()=>{J(_,"id",`${e.name??""}-description`),R(O,e.schema.description)}),i(x,_)};M(m,x=>{e.schema.description&&x(E)})}var q=n(m,2);{var P=x=>{var _=Er(),O=s(_,!0);a(_),V(()=>{J(_,"id",`${e.name??""}-error`),R(O,e.error)}),i(x,_)};M(q,x=>{e.error&&x(P)})}a(w),V(()=>{J(C,"for",e.name),R(F,`${e.name??""} `),J(u,"id",e.name),J(u,"aria-required",l()?"true":void 0),J(u,"aria-invalid",e.error?"true":void 0),J(u,"aria-describedby",e.error?`${e.name}-error`:e.schema.description?`${e.name}-description`:void 0),h!==(h=t(y)||"")&&(u.value=(u.__value=t(y)||"")??"",sa(u,t(y)||""))}),i(o,w),ke()}Te(["change"]);function Dr(o,e,r,l,v){const y=e("input"),w={inputs:[...t(r).inputs,y],outputs:t(r).outputs};l(w),v.onChange?.(w)}function Fr(o,e,r,l,v){const y=e("output"),w={inputs:t(r).inputs,outputs:[...t(r).outputs,y]};l(w),v.onChange?.(w)}var jr=d('<span class="required svelte-104fq2o">*</span>'),Mr=d('<span class="description svelte-104fq2o"> </span>'),Or=d('<p class="empty-state svelte-104fq2o">No input ports configured</p>'),Ir=d('<label class="field-label svelte-104fq2o"> </label> <input type="text" class="editable-field svelte-104fq2o"/>',1),Pr=d('<span class="field-label svelte-104fq2o"> </span> <span class="readonly-field svelte-104fq2o"> </span>',1),Ar=d('<div class="port-field svelte-104fq2o"><!></div>'),Hr=d('<div class="port-item svelte-104fq2o"><div class="port-fields svelte-104fq2o"></div> <button type="button" class="remove-button svelte-104fq2o">Remove</button></div>'),Nr=d('<div class="port-list svelte-104fq2o"></div>'),Vr=d('<p class="empty-state svelte-104fq2o">No output ports configured</p>'),Lr=d('<label class="field-label svelte-104fq2o"> </label> <input type="text" class="editable-field svelte-104fq2o"/>',1),Br=d('<span class="field-label svelte-104fq2o"> </span> <span class="readonly-field svelte-104fq2o"> </span>',1),Ur=d('<div class="port-field svelte-104fq2o"><!></div>'),Wr=d('<div class="port-item svelte-104fq2o"><div class="port-fields svelte-104fq2o"></div> <button type="button" class="remove-button svelte-104fq2o">Remove</button></div>'),Yr=d('<div class="port-list svelte-104fq2o"></div>'),Jr=d('<span class="error svelte-104fq2o" role="alert"> </span>'),Xr=d('<div class="port-config-editor svelte-104fq2o"><label class="svelte-104fq2o"> <!></label> <!> <section class="port-section svelte-104fq2o"><h4 class="svelte-104fq2o">Input Ports</h4> <!> <button type="button" class="add-button svelte-104fq2o">Add Input Port</button></section> <section class="port-section svelte-104fq2o"><h4 class="svelte-104fq2o">Output Ports</h4> <!> <button type="button" class="add-button svelte-104fq2o">Add Output Port</button></section> <!></div>');function Kr(o,e){we(e,!0);let r=be(e,"value",15),l=be(e,"isRequired",3,!1),v=U(()=>({inputs:r()?.inputs||[],outputs:r()?.outputs||[]})),y=U(()=>Object.entries(e.schema.portFields||{}).filter(([b,f])=>f.editable).map(([b,f])=>b));function w(b){return{id:`${b}_${Date.now()}`,name:`new_${b}`,direction:b,required:!1,description:"",config:{type:"nats",nats:{subject:"",interface:{type:"message.Storable"}}}}}function C(b){const f={inputs:t(v).inputs.filter((T,I)=>I!==b),outputs:t(v).outputs};r(f),e.onChange?.(f)}function F(b){const f={inputs:t(v).inputs,outputs:t(v).outputs.filter((T,I)=>I!==b)};r(f),e.onChange?.(f)}function A(b,f,T,I){const N=b==="input"?[...t(v).inputs]:[...t(v).outputs],Z={...N[f]};if(T.startsWith("config.")){const ce=T.split(".");if(ce.length===3&&ce[1]==="nats"&&Z.config.nats){const Q=ce[2];Z.config={...Z.config,nats:{...Z.config.nats,[Q]:I}}}else if(ce.length===3&&ce[1]==="jetstream"&&Z.config.jetstream){const Q=ce[2];Z.config={...Z.config,jetstream:{...Z.config.jetstream,[Q]:I}}}}else Z[T]=I;N[f]=Z;const $=b==="input"?{inputs:N,outputs:t(v).outputs}:{inputs:t(v).inputs,outputs:N};r($),e.onChange?.($)}function S(b,f){switch(f){case"name":return b.name;case"type":return b.config.type;case"required":return b.required?"Yes":"No";case"description":return b.description;case"interface":return b.config.nats?.interface?.type||b.config.jetstream?.interface?.type||"";case"subject":return b.config.nats?.subject||"";case"timeout":return b.config.natsRequest?.timeout||"";case"stream_name":return b.config.jetstream?.streamName||"";default:return""}}function u(b){switch(b){case"subject":return"config.nats.subject";case"timeout":return"config.natsRequest.timeout";case"stream_name":return"config.jetstream.stream_name";default:return b}}function j(b){return t(y).includes(b)}let H=U(()=>Object.keys(e.schema.portFields||{}));var g=Xr(),h=s(g),m=s(h),E=n(m);{var q=b=>{var f=jr();i(b,f)};M(E,b=>{l()&&b(q)})}a(h);var P=n(h,2);{var x=b=>{var f=Mr(),T=s(f,!0);a(f),V(()=>R(T,e.schema.description)),i(b,f)};M(P,b=>{e.schema.description&&b(x)})}var _=n(P,2),O=n(s(_),2);{var Y=b=>{var f=Or();i(b,f)},L=b=>{var f=Nr();Se(f,23,()=>t(v).inputs,T=>T.id,(T,I,N)=>{var Z=Hr(),$=s(Z);Se($,20,()=>t(H),Q=>Q,(Q,p)=>{var W=Ar(),te=s(W);{var ae=ve=>{var ge=Ir(),B=ue(ge),le=s(B,!0);a(B);var ne=n(B,2);at(ne),ne.__input=de=>A("input",t(N),u(p),de.currentTarget.value),V(de=>{J(B,"for",`${e.name??""}-input-${t(N)??""}-${p??""}`),R(le,p),J(ne,"id",`${e.name??""}-input-${t(N)??""}-${p??""}`),ut(ne,de)},[()=>S(t(I),p)]),i(ve,ge)},se=ve=>{var ge=Pr(),B=ue(ge),le=s(B,!0);a(B);var ne=n(B,2),de=s(ne,!0);a(ne),V(me=>{R(le,p),R(de,me)},[()=>S(t(I),p)]),i(ve,ge)};M(te,ve=>{j(p)?ve(ae):ve(se,!1)})}a(W),i(Q,W)}),a($);var ce=n($,2);ce.__click=()=>C(t(N)),a(Z),i(T,Z)}),a(f),i(b,f)};M(O,b=>{t(v).inputs.length===0?b(Y):b(L,!1)})}var G=n(O,2);G.__click=[Dr,w,v,r,e],a(_);var ie=n(_,2),ee=n(s(ie),2);{var z=b=>{var f=Vr();i(b,f)},k=b=>{var f=Yr();Se(f,23,()=>t(v).outputs,T=>T.id,(T,I,N)=>{var Z=Wr(),$=s(Z);Se($,20,()=>t(H),Q=>Q,(Q,p)=>{var W=Ur(),te=s(W);{var ae=ve=>{var ge=Lr(),B=ue(ge),le=s(B,!0);a(B);var ne=n(B,2);at(ne),ne.__input=de=>A("output",t(N),u(p),de.currentTarget.value),V(de=>{J(B,"for",`${e.name??""}-output-${t(N)??""}-${p??""}`),R(le,p),J(ne,"id",`${e.name??""}-output-${t(N)??""}-${p??""}`),ut(ne,de)},[()=>S(t(I),p)]),i(ve,ge)},se=ve=>{var ge=Br(),B=ue(ge),le=s(B,!0);a(B);var ne=n(B,2),de=s(ne,!0);a(ne),V(me=>{R(le,p),R(de,me)},[()=>S(t(I),p)]),i(ve,ge)};M(te,ve=>{j(p)?ve(ae):ve(se,!1)})}a(W),i(Q,W)}),a($);var ce=n($,2);ce.__click=()=>F(t(N)),a(Z),i(T,Z)}),a(f),i(b,f)};M(ee,b=>{t(v).outputs.length===0?b(z):b(k,!1)})}var D=n(ee,2);D.__click=[Fr,w,v,r,e],a(ie);var K=n(ie,2);{var re=b=>{var f=Jr(),T=s(f,!0);a(f),V(()=>R(T,e.error)),i(b,f)};M(K,b=>{e.error&&b(re)})}a(g),V(()=>{J(h,"for",e.name),R(m,`${e.name??""} `)}),i(o,g),ke()}Te(["input","click"]);var Zr=d('<span class="required svelte-1eupbqd">*</span>'),Gr=d('<p class="description svelte-1eupbqd"> </p>'),Qr=d('<span class="error svelte-1eupbqd" role="alert"> </span>'),$r=d('<div class="field complex-field-fallback svelte-1eupbqd"><label class="svelte-1eupbqd"> <!></label> <div class="fallback-message svelte-1eupbqd"><p class="svelte-1eupbqd">‚ö†Ô∏è This field requires complex configuration. Use JSON editor.</p> <!></div> <!></div>'),es=d('<div class="field unknown-field-type svelte-1eupbqd"><label class="svelte-1eupbqd"> </label> <div class="fallback-message svelte-1eupbqd"><p class="svelte-1eupbqd"> </p></div></div>');function Rt(o,e){we(e,!0);let r=be(e,"value",15,void 0),l=be(e,"isRequired",3,!1);var v=he(),y=ue(v);{var w=F=>{dr(F,{get name(){return e.name},get schema(){return e.schema},get error(){return e.error},get isRequired(){return l()},get onChange(){return e.onChange},get value(){return r()},set value(A){r(A)}})},C=F=>{var A=he(),S=ue(A);{var u=H=>{mr(H,{get name(){return e.name},get schema(){return e.schema},get error(){return e.error},get isRequired(){return l()},get onChange(){return e.onChange},get value(){return r()},set value(g){r(g)}})},j=H=>{var g=he(),h=ue(g);{var m=q=>{kr(q,{get name(){return e.name},get schema(){return e.schema},get error(){return e.error},get isRequired(){return l()},get onChange(){return e.onChange},get value(){return r()},set value(P){r(P)}})},E=q=>{var P=he(),x=ue(P);{var _=Y=>{Rr(Y,{get name(){return e.name},get schema(){return e.schema},get error(){return e.error},get isRequired(){return l()},get onChange(){return e.onChange},get value(){return r()},set value(L){r(L)}})},O=Y=>{var L=he(),G=ue(L);{var ie=z=>{Kr(z,{get name(){return e.name},get schema(){return e.schema},get error(){return e.error},get isRequired(){return l()},get onChange(){return e.onChange},get value(){return r()},set value(k){r(k)}})},ee=z=>{var k=he(),D=ue(k);{var K=b=>{var f=$r(),T=s(f),I=s(T),N=n(I);{var Z=te=>{var ae=Zr();i(te,ae)};M(N,te=>{l()&&te(Z)})}a(T);var $=n(T,2),ce=n(s($),2);{var Q=te=>{var ae=Gr(),se=s(ae,!0);a(ae),V(()=>R(se,e.schema.description)),i(te,ae)};M(ce,te=>{e.schema.description&&te(Q)})}a($);var p=n($,2);{var W=te=>{var ae=Qr(),se=s(ae,!0);a(ae),V(()=>R(se,e.error)),i(te,ae)};M(p,te=>{e.error&&te(W)})}a(f),V(()=>{J(T,"for",e.name),R(I,`${e.name??""} `)}),i(b,f)},re=b=>{var f=es(),T=s(f),I=s(T,!0);a(T);var N=n(T,2),Z=s(N),$=s(Z);a(Z),a(N),a(f),V(()=>{J(T,"for",e.name),R(I,e.name),R($,`‚ö†Ô∏è Unknown field type: ${e.schema.type??""}`)}),i(b,f)};M(D,b=>{e.schema.type==="object"||e.schema.type==="array"?b(K):b(re,!1)},!0)}i(z,k)};M(G,z=>{e.schema.type==="ports"?z(ie):z(ee,!1)},!0)}i(Y,L)};M(x,Y=>{e.schema.type==="enum"?Y(_):Y(O,!1)},!0)}i(q,P)};M(h,q=>{e.schema.type==="bool"?q(m):q(E,!1)},!0)}i(H,g)};M(S,H=>{e.schema.type==="int"||e.schema.type==="float"?H(u):H(j,!1)},!0)}i(F,A)};M(y,F=>{e.schema.type==="string"?F(w):F(C,!1)})}i(o,v),ke()}function ts(o,e){e.onCancel?.()}var as=d('<section class="basic-config svelte-uz0bzf"><h3 class="svelte-uz0bzf">Basic Configuration</h3> <!></section>'),rs=d('<details class="advanced-config svelte-uz0bzf"><summary class="svelte-uz0bzf">Advanced Configuration</summary> <!></details>'),ss=d('<form class="schema-form svelte-uz0bzf"><!> <!> <div class="actions svelte-uz0bzf"><button type="submit" class="svelte-uz0bzf"> </button> <button type="button" class="svelte-uz0bzf">Cancel</button></div></form>');function ns(o,e){we(e,!0);let r=be(e,"config",31,()=>ze({})),l=be(e,"externalErrors",19,()=>({})),v=be(e,"saving",3,!1),y=oe(ze({})),w=U(()=>({...t(y),...l()})),C=ze({});Fe(()=>{const _=e.schema.properties;for(const[O,Y]of Object.entries(_))Ot(()=>r()[O])===void 0&&Y.default!==void 0&&r(r()[O]=Y.default,!0)});let F=U(()=>Object.entries(e.schema.properties).filter(([_,O])=>O.category==="basic").sort(([_],[O])=>_.localeCompare(O))),A=U(()=>Object.entries(e.schema.properties).filter(([_,O])=>O.category!=="basic").sort(([_],[O])=>_.localeCompare(O)));function S(_,O){r(r()[_]=O,!0),C[_]&&clearTimeout(C[_]),C[_]=setTimeout(()=>{const Y=e.schema.properties[_],L=e.schema.required.includes(_),G=Tt(_,O,Y,L);G?t(y)[_]=G.message:delete t(y)[_],c(y,{...t(y)},!0)},300)}function u(_){_.preventDefault();const O={};for(const[Y,L]of Object.entries(e.schema.properties)){const G=e.schema.required.includes(Y),ie=Tt(Y,r()[Y],L,G);ie&&(O[Y]=ie.message)}c(y,O,!0),!(Object.keys(t(y)).length>0)&&e.onSave?.(r())}var j=ss(),H=s(j);{var g=_=>{var O=as(),Y=n(s(O),2);Se(Y,17,()=>t(F),([L,G])=>L,(L,G)=>{var ie=U(()=>tt(t(G),2));let ee=()=>t(ie)[0],z=()=>t(ie)[1];{let k=U(()=>e.schema.required.includes(ee()));Rt(L,{get name(){return ee()},get schema(){return z()},get error(){return t(w)[ee()]},get isRequired(){return t(k)},onChange:D=>S(ee(),D),get value(){return r()[ee()]},set value(D){r(r()[ee()]=D,!0)}})}}),a(O),i(_,O)};M(H,_=>{t(F).length>0&&_(g)})}var h=n(H,2);{var m=_=>{var O=rs(),Y=n(s(O),2);Se(Y,17,()=>t(A),([L,G])=>L,(L,G)=>{var ie=U(()=>tt(t(G),2));let ee=()=>t(ie)[0],z=()=>t(ie)[1];{let k=U(()=>e.schema.required.includes(ee()));Rt(L,{get name(){return ee()},get schema(){return z()},get error(){return t(w)[ee()]},get isRequired(){return t(k)},onChange:D=>S(ee(),D),get value(){return r()[ee()]},set value(D){r(r()[ee()]=D,!0)}})}}),a(O),i(_,O)};M(h,_=>{t(A).length>0&&_(m)})}var E=n(h,2),q=s(E),P=s(q,!0);a(q);var x=n(q,2);x.__click=[ts,e],a(E),a(j),V(_=>{q.disabled=_,J(q,"aria-busy",v()?"true":"false"),R(P,v()?"Saving...":"Save"),x.disabled=v()},[()=>v()||Object.keys(t(w)).length>0]),Qe("submit",j,u),i(o,j),ke()}Te(["click"]);function os(o,e,r,l){const v=o.target;c(e,v.value,!0);try{const y=JSON.parse(t(e));r(y),l(null)}catch(y){l(y instanceof Error?y.message:"Invalid JSON")}}var ls=d('<div class="warning svelte-1r0n3md" role="alert"> </div>'),is=d('<span class="error svelte-1r0n3md" id="json-error" role="alert"> </span>'),vs=d('<div class="json-editor svelte-1r0n3md"><!> <label for="json-config" class="svelte-1r0n3md">Configuration (JSON)</label> <textarea id="json-config" rows="15" class="svelte-1r0n3md"></textarea> <!> <p class="help-text svelte-1r0n3md">Enter valid JSON configuration for this component.</p></div>');function Dt(o,e){we(e,!0);let r=be(e,"config",31,()=>ze({})),l=be(e,"parseError",15,null),v=oe(ze(JSON.stringify(r(),null,2)));Fe(()=>{try{c(v,JSON.stringify(r(),null,2),!0)}catch{}});var y=vs(),w=s(y);{var C=u=>{var j=ls(),H=s(j);a(j),V(()=>R(H,`‚ö†Ô∏è ${e.warning??""}`)),i(u,j)};M(w,u=>{e.warning&&u(C)})}var F=n(w,4);Gt(F),F.__input=[os,v,r,l];var A=n(F,2);{var S=u=>{var j=is(),H=s(j,!0);a(j),V(()=>R(H,l())),i(u,j)};M(A,u=>{l()&&u(S)})}gt(2),a(y),V(()=>{ut(F,t(v)),J(F,"aria-invalid",l()?"true":void 0),J(F,"aria-describedby",l()?"json-error":void 0)}),i(o,y),ke()}Te(["input"]);function Ft(o,e,r,l,v,y){if(e.component){if(t(r)){c(l,t(r),!0);return}t(v)&&typeof t(v)=="object"?(y.delete(e.component.id),e.onSave?.(e.component.id,t(v)),c(l,null),e.onClose?.()):c(l,"Invalid configuration")}}var ds=d('<div class="info-item svelte-wzegms"><span class="label svelte-wzegms">Health:</span> <span> </span></div>'),cs=d('<div class="loading-message svelte-wzegms"><p class="svelte-wzegms">Loading schema...</p></div>'),us=d('<div class="error-message svelte-wzegms" role="alert"><p> </p> <p>Falling back to JSON editor.</p></div> <!> <footer class="svelte-wzegms"><button class="cancel-button svelte-wzegms">Cancel</button> <button class="save-button svelte-wzegms">Apply</button></footer>',1),fs=d('<div class="error-message svelte-wzegms" role="alert"><p> </p></div>'),gs=d("<!> <!>",1),_s=d('<!> <footer class="svelte-wzegms"><button class="cancel-button svelte-wzegms">Cancel</button> <button class="save-button svelte-wzegms">Apply</button></footer>',1),ms=d('<div class="config-panel svelte-wzegms"><header class="svelte-wzegms"><h3 class="svelte-wzegms"> </h3> <button class="close-button svelte-wzegms" aria-label="Close">‚úï</button></header> <div class="panel-body svelte-wzegms"><div class="component-info svelte-wzegms"><div class="info-item svelte-wzegms"><span class="label svelte-wzegms">ID:</span> <span class="value svelte-wzegms"> </span></div> <div class="info-item svelte-wzegms"><span class="label svelte-wzegms">Type:</span> <span class="value svelte-wzegms"> </span></div> <div class="info-item svelte-wzegms"><span class="label svelte-wzegms">Name:</span> <span class="value svelte-wzegms"> </span></div> <!></div> <!></div></div>');function hs(o,e){we(e,!0);let r=ze(new Map),l=oe(null),v=oe(!1),y=oe(null),w=ze(new Map),C=oe(ze({})),F=oe(null),A=oe(null),S=oe(ze({})),u=oe(null),j=oe(null);Fe(()=>{e.component&&e.component.id!==t(u)?(t(j)&&t(j)!==t(u)&&w.set(t(j),t(C)),c(u,e.component.id,!0),c(j,t(u),!0),H(e.component.type),w.has(e.component.id)?c(C,{...w.get(e.component.id)},!0):c(C,{...e.component.config},!0),c(F,null),c(y,null),c(A,null)):e.component||(c(u,null),c(j,null),c(l,null),c(C,{},!0),c(A,null))}),Fe(()=>{e.component&&t(u)&&t(C)&&w.set(t(u),t(C))});async function H(P){if(r.has(P)){c(l,r.get(P),!0);return}c(v,!0),c(y,null);try{const x=await fetch(`/components/types/${P}`);if(x.status===404){c(l,null),r.set(P,null);return}if(!x.ok)throw new Error(`Failed to load schema: ${x.statusText}`);const _=await x.json();c(l,_,!0),r.set(P,_)}catch(x){c(y,x instanceof Error?x.message:"Failed to load schema",!0),c(l,null)}finally{c(v,!1)}}function g(P){e.component&&(c(S,{},!0),c(F,null),w.delete(e.component.id),e.onSave?.(e.component.id,P),e.onClose?.())}function h(){e.component&&(w.delete(e.component.id),c(C,{...e.component.config},!0),c(F,null),c(A,null)),e.onClose?.()}var m=he(),E=ue(m);{var q=P=>{var x=ms(),_=s(x),O=s(_),Y=s(O);a(O);var L=n(O,2);L.__click=h,a(_);var G=n(_,2),ie=s(G),ee=s(ie),z=n(s(ee),2),k=s(z,!0);a(z),a(ee);var D=n(ee,2),K=n(s(D),2),re=s(K,!0);a(K),a(D);var b=n(D,2),f=n(s(b),2),T=s(f,!0);a(f),a(b);var I=n(b,2);{var N=Q=>{var p=ds(),W=n(s(p),2),te=s(W,!0);a(W),a(p),V(()=>{Ee(W,1,`value ${e.component.health.status??""}`,"svelte-wzegms"),R(te,e.component.health.status)}),i(Q,p)};M(I,Q=>{e.component.health&&Q(N)})}a(ie);var Z=n(ie,2);{var $=Q=>{var p=cs();i(Q,p)},ce=Q=>{var p=he(),W=ue(p);{var te=se=>{var ve=us(),ge=ue(ve),B=s(ge),le=s(B);a(B),gt(2),a(ge);var ne=n(ge,2);Dt(ne,{warning:"Schema unavailable - using JSON editor",get config(){return t(C)},set config(xe){c(C,xe,!0)},get parseError(){return t(A)},set parseError(xe){c(A,xe,!0)}});var de=n(ne,2),me=s(de);me.__click=h;var ye=n(me,2);ye.__click=[Ft,e,A,F,C,w],a(de),V(()=>R(le,`Failed to load schema: ${t(y)??""}`)),i(se,ve)},ae=se=>{var ve=he(),ge=ue(ve);{var B=ne=>{var de=gs(),me=ue(de);{var ye=Re=>{var Ce=fs(),He=s(Ce),De=s(He,!0);a(He),a(Ce),V(()=>R(De,t(F))),i(Re,Ce)};M(me,Re=>{t(F)&&Re(ye)})}var xe=n(me,2);ns(xe,{get schema(){return t(l).schema},get externalErrors(){return t(S)},saving:!1,onSave:g,onCancel:h,get config(){return t(C)},set config(Re){c(C,Re,!0)}}),i(ne,de)},le=ne=>{var de=_s(),me=ue(de);Dt(me,{warning:"Schema not available for this component type",get config(){return t(C)},set config(Ce){c(C,Ce,!0)},get parseError(){return t(A)},set parseError(Ce){c(A,Ce,!0)}});var ye=n(me,2),xe=s(ye);xe.__click=h;var Re=n(xe,2);Re.__click=[Ft,e,A,F,C,w],a(ye),i(ne,de)};M(ge,ne=>{t(l)?ne(B):ne(le,!1)},!0)}i(se,ve)};M(W,se=>{t(y)?se(te):se(ae,!1)},!0)}i(Q,p)};M(Z,Q=>{t(v)?Q($):Q(ce,!1)})}a(G),a(x),V(()=>{R(Y,`Configure: ${e.component.type??""}`),R(k,e.component.id),R(re,e.component.type),R(T,e.component.name)}),i(P,x)};M(E,P=>{e.component&&P(q)})}i(o,m),ke()}Te(["click"]);var bs=d('<span class="state-icon svelte-1piydef" role="img" aria-label="Running">‚ñ∂Ô∏è</span>'),ps=d('<span class="state-icon svelte-1piydef" role="img" aria-label="Stopped">‚èπÔ∏è</span>'),ys=d('<span class="state-icon svelte-1piydef" role="img" aria-label="Error">üî¥</span>'),ws=d('<div class="error-section svelte-1piydef" role="alert"><span class="error-icon svelte-1piydef">‚ö†</span> <span class="error-message svelte-1piydef"> </span></div>'),ks=d('<div class="status-message svelte-1piydef" role="status">Cannot edit running flow</div>'),Ss=(o,e)=>e.onDeploy?.(),xs=d('<button class="deploy-button svelte-1piydef" aria-label="Deploy flow">Deploy</button>'),Cs=(o,e)=>e.onStart?.(),qs=d('<button class="start-button svelte-1piydef" aria-label="Start flow">Start</button>'),zs=(o,e)=>e.onStop?.(),Es=d('<button class="stop-button svelte-1piydef" aria-label="Stop flow">Stop</button>'),Ts=(o,e)=>e.onToggleRuntimePanel?.(),Rs=d('<button class="debug-button svelte-1piydef" aria-label="Toggle runtime panel" title="Toggle runtime panel (Ctrl+`)" data-testid="debug-toggle-button"> </button>'),Ds=d('<div class="status-bar svelte-1piydef" data-testid="status-bar"><div class="status-section svelte-1piydef"><span class="status-label svelte-1piydef">Runtime:</span> <span aria-live="polite" aria-atomic="true"><!> </span></div> <!> <!> <div class="button-section svelte-1piydef"><!> <!> <!> <!></div></div>');function Fs(o,e){we(e,!0);let r=be(e,"showRuntimePanel",3,!1);const l=U(()=>e.runtimeState.state==="not_deployed"),v=U(()=>e.runtimeState.state==="deployed_stopped"),y=U(()=>e.runtimeState.state==="running"),w=U(()=>e.runtimeState.state==="running"),C=U(()=>!e.isFlowValid||e.runtimeState.state!=="not_deployed"),F=U(()=>e.runtimeState.state!=="not_deployed"?"Flow must be in not_deployed state":e.isFlowValid?"Deploy this flow":"Fix validation errors before deploying");var A=Ds(),S=s(A),u=n(s(S),2),j=s(u);{var H=k=>{var D=bs();i(k,D)},g=k=>{var D=he(),K=ue(D);{var re=f=>{var T=ps();i(f,T)},b=f=>{var T=he(),I=ue(T);{var N=Z=>{var $=ys();i(Z,$)};M(I,Z=>{e.runtimeState.state==="error"&&Z(N)},!0)}i(f,T)};M(K,f=>{e.runtimeState.state==="deployed_stopped"?f(re):f(b,!1)},!0)}i(k,D)};M(j,k=>{e.runtimeState.state==="running"?k(H):k(g,!1)})}var h=n(j);a(u),a(S);var m=n(S,2);{var E=k=>{var D=ws(),K=n(s(D),2),re=s(K,!0);a(K),a(D),V(()=>R(re,e.runtimeState.message)),i(k,D)};M(m,k=>{e.runtimeState.state==="error"&&e.runtimeState.message&&k(E)})}var q=n(m,2);{var P=k=>{var D=ks();i(k,D)};M(q,k=>{e.runtimeState.state==="running"&&k(P)})}var x=n(q,2),_=s(x);{var O=k=>{var D=xs();D.__click=[Ss,e],V(()=>{D.disabled=t(C),J(D,"title",t(F))}),i(k,D)};M(_,k=>{t(l)&&k(O)})}var Y=n(_,2);{var L=k=>{var D=qs();D.__click=[Cs,e],V(()=>D.disabled=e.runtimeState.state!=="deployed_stopped"),i(k,D)};M(Y,k=>{t(v)&&k(L)})}var G=n(Y,2);{var ie=k=>{var D=Es();D.__click=[zs,e],V(()=>D.disabled=e.runtimeState.state!=="running"),i(k,D)};M(G,k=>{t(y)&&k(ie)})}var ee=n(G,2);{var z=k=>{var D=Rs();D.__click=[Ts,e];var K=s(D);a(D),V(()=>R(K,`${r()?"‚ñº":"‚ñ≤"} Debug`)),i(k,D)};M(ee,k=>{t(w)&&k(z)})}a(x),a(A),V(()=>{Ee(u,1,`runtime-state ${e.runtimeState.state??""}`,"svelte-1piydef"),J(u,"data-state",e.runtimeState.state),R(h,` ${e.runtimeState.state??""}`)}),i(o,A),ke()}Te(["click"]);function js(o,e,r,l){c(e,[],!0),c(r,"all"),c(l,"all")}var Ms=d("<option> </option>"),Os=d('<div class="connection-status error svelte-v3r1ht" data-testid="connection-error"><span class="status-icon svelte-v3r1ht">‚ö†</span> <span> </span></div>'),Is=d('<div class="connection-status connecting svelte-v3r1ht" data-testid="connection-connecting"><span class="status-icon svelte-v3r1ht">‚ãØ</span> <span>Connecting to log stream...</span></div>'),Ps=d('<p class="svelte-v3r1ht">No logs yet. Waiting for runtime events...</p>'),As=d('<p class="svelte-v3r1ht">No logs match current filters.</p>'),Hs=d('<div class="empty-state svelte-v3r1ht"><!></div>'),Ns=d('<div class="log-entry svelte-v3r1ht" data-testid="log-entry"><span class="log-timestamp svelte-v3r1ht"> </span> <span class="log-level svelte-v3r1ht"> </span> <span class="log-component svelte-v3r1ht"> </span> <span class="log-message svelte-v3r1ht"> </span></div>'),Vs=d('<div class="log-entries svelte-v3r1ht" role="log" aria-live="polite" aria-atomic="false"></div>'),Ls=d('<div class="logs-tab svelte-v3r1ht" data-testid="logs-tab"><div class="filter-bar svelte-v3r1ht"><div class="filter-controls svelte-v3r1ht"><label for="level-filter" class="svelte-v3r1ht"><span class="filter-label svelte-v3r1ht">Level:</span> <select id="level-filter" data-testid="level-filter" class="svelte-v3r1ht"><option>All Levels</option><option>DEBUG</option><option>INFO</option><option>WARN</option><option>ERROR</option></select></label> <label for="component-filter" class="svelte-v3r1ht"><span class="filter-label svelte-v3r1ht">Component:</span> <select id="component-filter" data-testid="component-filter" class="svelte-v3r1ht"><option>All Components</option><!></select></label> <button class="clear-button svelte-v3r1ht" data-testid="clear-logs-button" aria-label="Clear all logs">Clear</button></div> <div class="auto-scroll-control svelte-v3r1ht"><label for="auto-scroll" class="svelte-v3r1ht"><input type="checkbox" id="auto-scroll" data-testid="auto-scroll-toggle" class="svelte-v3r1ht"/> <span>Auto-scroll</span></label></div></div> <!> <div class="log-container svelte-v3r1ht" data-testid="log-container"><!></div></div>');function Bs(o,e){we(e,!0);let r=oe(ze([])),l=oe("all"),v=oe("all"),y=oe(!0),w=oe("disconnected"),C=oe(null),F=null;const A=U(()=>Array.from(new Set(t(r).map(p=>p.component))).sort()),S=U(()=>t(r).filter(p=>{const W=t(l)==="all"||p.level===t(l),te=t(v)==="all"||p.component===t(v);return W&&te}));let u=null;function j(p){c(r,[...t(r),p].slice(-1e3),!0),t(y)&&F&&requestAnimationFrame(()=>{F&&(F.scrollTop=F.scrollHeight)})}function H(p){try{const W=new Date(p),te=W.getHours().toString().padStart(2,"0"),ae=W.getMinutes().toString().padStart(2,"0"),se=W.getSeconds().toString().padStart(2,"0"),ve=W.getMilliseconds().toString().padStart(3,"0");return`${te}:${ae}:${se}.${ve}`}catch{return p}}function g(p){return{DEBUG:"var(--ui-text-secondary)",INFO:"var(--status-info)",WARN:"var(--status-warning)",ERROR:"var(--status-error)"}[p]}function h(){if(!(!e.isActive||u)){c(w,"connecting"),c(C,null);try{const p=`/flowbuilder/flows/${e.flowId}/runtime/logs`;u=new EventSource(p),u.addEventListener("open",()=>{c(w,"connected"),console.log("[LogsTab] SSE connection established")}),u.addEventListener("log",W=>{try{const te=JSON.parse(W.data);j(te)}catch(te){console.error("[LogsTab] Failed to parse log entry:",te)}}),u.addEventListener("error",W=>{console.warn("[LogsTab] SSE connection error:",W),c(w,"error"),c(C,"Log streaming unavailable - backend endpoint not ready"),u&&(u.close(),u=null)})}catch(p){console.error("[LogsTab] Failed to create SSE connection:",p),c(w,"error"),c(C,"Failed to connect to log stream")}}}function m(){u&&(u.close(),u=null,c(w,"disconnected"),console.log("[LogsTab] SSE connection closed"))}Fe(()=>(e.isActive?h():m(),()=>{m()})),Fe(()=>{t(S),t(y)&&F&&requestAnimationFrame(()=>{F&&(F.scrollTop=F.scrollHeight)})});var E=Ls(),q=s(E),P=s(q),x=s(P),_=n(s(x),2),O=s(_);O.value=O.__value="all";var Y=n(O);Y.value=Y.__value="DEBUG";var L=n(Y);L.value=L.__value="INFO";var G=n(L);G.value=G.__value="WARN";var ie=n(G);ie.value=ie.__value="ERROR",a(_),a(x);var ee=n(x,2),z=n(s(ee),2),k=s(z);k.value=k.__value="all";var D=n(k);Se(D,16,()=>t(A),p=>p,(p,W)=>{var te=Ms(),ae=s(te,!0);a(te);var se={};V(()=>{R(ae,W),se!==(se=W)&&(te.value=(te.__value=W)??"")}),i(p,te)}),a(z),a(ee);var K=n(ee,2);K.__click=[js,r,l,v],a(P);var re=n(P,2),b=s(re),f=s(b);at(f),gt(2),a(b),a(re),a(q);var T=n(q,2);{var I=p=>{var W=Os(),te=n(s(W),2),ae=s(te,!0);a(te),a(W),V(()=>R(ae,t(C)||"Log streaming unavailable")),i(p,W)},N=p=>{var W=he(),te=ue(W);{var ae=se=>{var ve=Is();i(se,ve)};M(te,se=>{t(w)==="connecting"&&se(ae)},!0)}i(p,W)};M(T,p=>{t(w)==="error"?p(I):p(N,!1)})}var Z=n(T,2),$=s(Z);{var ce=p=>{var W=Hs(),te=s(W);{var ae=ve=>{var ge=Ps();i(ve,ge)},se=ve=>{var ge=As();i(ve,ge)};M(te,ve=>{t(r).length===0?ve(ae):ve(se,!1)})}a(W),i(p,W)},Q=p=>{var W=Vs();Se(W,21,()=>t(S),te=>te.timestamp+te.component+te.message,(te,ae)=>{var se=Ns(),ve=s(se),ge=s(ve,!0);a(ve);var B=n(ve,2),le=s(B,!0);a(B);var ne=n(B,2),de=s(ne);a(ne);var me=n(ne,2),ye=s(me,!0);a(me),a(se),V((xe,Re)=>{J(se,"data-level",t(ae).level),R(ge,xe),Le(B,`color: ${Re??""}`),R(le,t(ae).level),R(de,`[${t(ae).component??""}]`),R(ye,t(ae).message)},[()=>H(t(ae).timestamp),()=>g(t(ae).level)]),i(te,se)}),a(W),i(p,W)};M($,p=>{t(S).length===0?p(ce):p(Q,!1)})}a(Z),$e(Z,p=>F=p,()=>F),a(E),lt(_,()=>t(l),p=>c(l,p)),lt(z,()=>t(v),p=>c(v,p)),At(f,()=>t(y),p=>c(y,p)),i(o,E),ke()}Te(["click"]);function Us(o,e,r,l,v){c(e,[],!0),c(r,"all"),c(l,"all"),v.clear()}function Ws(o,e){e()}var Ys=d("<option> </option>"),Js=d('<button class="refresh-button svelte-7dk3q0" data-testid="manual-refresh-button" aria-label="Refresh messages now">Refresh</button>'),Xs=d('<div class="error-message svelte-7dk3q0" role="alert"><span class="error-icon svelte-7dk3q0">‚ö†</span> <span> </span></div>'),Ks=d('<p class="svelte-7dk3q0">No messages yet. Waiting for NATS traffic...</p>'),Zs=d('<p class="svelte-7dk3q0">No messages match current filters.</p>'),Gs=d('<div class="empty-state svelte-7dk3q0"><!></div>'),Qs=(o,e,r)=>e(t(r).message_id),$s=d('<button class="metadata-toggle svelte-7dk3q0" aria-label="Toggle metadata"> </button>'),en=d('<div class="metadata svelte-7dk3q0"><pre class="svelte-7dk3q0"> </pre></div>'),tn=d('<div class="message-entry svelte-7dk3q0" data-testid="message-entry"><span class="timestamp svelte-7dk3q0"> </span> <span> </span> <span class="component svelte-7dk3q0"> </span> <span class="subject svelte-7dk3q0"> </span> <span class="summary svelte-7dk3q0"> </span> <!></div> <!>',1),an=d('<div class="message-entries svelte-7dk3q0" role="log" aria-live="polite" aria-atomic="false"></div>'),rn=d('<div class="messages-tab svelte-7dk3q0" data-testid="messages-tab"><div class="control-bar svelte-7dk3q0"><div class="filter-controls svelte-7dk3q0"><label for="component-filter" class="svelte-7dk3q0"><span class="filter-label svelte-7dk3q0">Component:</span> <select id="component-filter" data-testid="component-filter" aria-label="Filter by component" class="svelte-7dk3q0"><option>All Components</option><!></select></label> <label for="direction-filter" class="svelte-7dk3q0"><span class="filter-label svelte-7dk3q0">Direction:</span> <select id="direction-filter" data-testid="direction-filter" aria-label="Filter by direction" class="svelte-7dk3q0"><option>All</option><option>Published</option><option>Received</option><option>Processed</option></select></label> <label for="poll-rate" class="svelte-7dk3q0"><span class="filter-label svelte-7dk3q0">Poll:</span> <select id="poll-rate" data-testid="poll-rate-selector" aria-label="Poll rate" class="svelte-7dk3q0"><option>Every 1s</option><option>Every 2s</option><option>Every 5s</option><option>Manual</option></select></label> <!> <button class="clear-button svelte-7dk3q0" data-testid="clear-messages-button" aria-label="Clear all messages">Clear</button></div> <div class="auto-scroll-control svelte-7dk3q0"><label for="auto-scroll" class="svelte-7dk3q0"><input type="checkbox" id="auto-scroll" data-testid="auto-scroll-toggle" class="svelte-7dk3q0"/> <span>Auto-scroll</span></label></div></div> <!> <div class="messages-container svelte-7dk3q0" data-testid="messages-container"><!></div></div>');function sn(o,e){we(e,!0);let r=oe(ze([])),l=oe("all"),v=oe("all"),y=oe(!0),w=oe(2e3),C=new ft,F=oe(null),A=null;const S=500,u=U(()=>Array.from(new Set(t(r).map(B=>B.component))).sort()),j=U(()=>t(r).filter(B=>{const le=t(l)==="all"||B.component===t(l),ne=t(v)==="all"||B.direction===t(v);return le&&ne}));function H(B){try{const le=new Date(B),ne=le.getHours().toString().padStart(2,"0"),de=le.getMinutes().toString().padStart(2,"0"),me=le.getSeconds().toString().padStart(2,"0"),ye=le.getMilliseconds().toString().padStart(3,"0");return`${ne}:${de}:${me}.${ye}`}catch{return B}}function g(B){return{published:"‚Üí",received:"‚Üê",processed:"‚ü≥"}[B]}function h(B){return{published:"var(--status-info)",received:"var(--status-success)",processed:"var(--ui-text-secondary)"}[B]}function m(B){C.has(B)?C.delete(B):C.add(B)}async function E(){try{const B=await fetch(`/flowbuilder/flows/${e.flowId}/runtime/messages`);if(!B.ok)throw new Error(`HTTP ${B.status}: ${B.statusText}`);const le=await B.json(),ne=new Set(t(r).map(me=>me.message_id)),de=le.messages.filter(me=>!ne.has(me.message_id));c(r,[...t(r),...de].slice(-S),!0),c(F,null),t(y)&&A&&requestAnimationFrame(()=>{A&&(A.scrollTop=A.scrollHeight)})}catch(B){c(F,"Messages unavailable - backend endpoint not ready"),console.warn("[MessagesTab] Messages fetch failed:",B)}}Fe(()=>{if(!e.isActive||t(w)==="manual")return;E();const B=setInterval(E,t(w));return()=>{clearInterval(B)}}),Fe(()=>{t(j),t(y)&&A&&requestAnimationFrame(()=>{A&&(A.scrollTop=A.scrollHeight)})});var q=rn(),P=s(q),x=s(P),_=s(x),O=n(s(_),2),Y=s(O);Y.value=Y.__value="all";var L=n(Y);Se(L,16,()=>t(u),B=>B,(B,le)=>{var ne=Ys(),de=s(ne,!0);a(ne);var me={};V(()=>{R(de,le),me!==(me=le)&&(ne.value=(ne.__value=le)??"")}),i(B,ne)}),a(O),a(_);var G=n(_,2),ie=n(s(G),2),ee=s(ie);ee.value=ee.__value="all";var z=n(ee);z.value=z.__value="published";var k=n(z);k.value=k.__value="received";var D=n(k);D.value=D.__value="processed",a(ie),a(G);var K=n(G,2),re=n(s(K),2),b=s(re);b.value=b.__value=1e3;var f=n(b);f.value=f.__value=2e3;var T=n(f);T.value=T.__value=5e3;var I=n(T);I.value=I.__value="manual",a(re),a(K);var N=n(K,2);{var Z=B=>{var le=Js();le.__click=[Ws,E],i(B,le)};M(N,B=>{t(w)==="manual"&&B(Z)})}var $=n(N,2);$.__click=[Us,r,l,v,C],a(x);var ce=n(x,2),Q=s(ce),p=s(Q);at(p),gt(2),a(Q),a(ce),a(P);var W=n(P,2);{var te=B=>{var le=Xs(),ne=n(s(le),2),de=s(ne,!0);a(ne),a(le),V(()=>R(de,t(F))),i(B,le)};M(W,B=>{t(F)&&B(te)})}var ae=n(W,2),se=s(ae);{var ve=B=>{var le=Gs(),ne=s(le);{var de=ye=>{var xe=Ks();i(ye,xe)},me=ye=>{var xe=Zs();i(ye,xe)};M(ne,ye=>{t(r).length===0?ye(de):ye(me,!1)})}a(le),i(B,le)},ge=B=>{var le=an();Se(le,21,()=>t(j),ne=>ne.message_id,(ne,de)=>{var me=tn(),ye=ue(me),xe=s(ye),Re=s(xe,!0);a(xe);var Ce=n(xe,2);let He;var De=s(Ce,!0);a(Ce);var qe=n(Ce,2),Pe=s(qe);a(qe);var je=n(qe,2),Me=s(je,!0);a(je);var Ae=n(je,2),Be=s(Ae,!0);a(Ae);var vt=n(Ae,2);{var rt=Ie=>{var Oe=$s();Oe.__click=[Qs,m,de];var Ve=s(Oe,!0);a(Oe),V((Ue,X)=>{J(Oe,"aria-expanded",Ue),R(Ve,X)},[()=>C.has(t(de).message_id),()=>C.has(t(de).message_id)?"‚ñº":"‚ñ∂"]),i(Ie,Oe)};M(vt,Ie=>{t(de).metadata&&Ie(rt)})}a(ye);var Je=n(ye,2);{var st=Ie=>{var Oe=en(),Ve=s(Oe),Ue=s(Ve,!0);a(Ve),a(Oe),V(X=>R(Ue,X),[()=>JSON.stringify(t(de).metadata,null,2)]),i(Ie,Oe)};M(Je,Ie=>{C.has(t(de).message_id)&&t(de).metadata&&Ie(st)})}V((Ie,Oe,Ve,Ue)=>{R(Re,Ie),He=Ee(Ce,1,"direction svelte-7dk3q0",null,He,Oe),Le(Ce,`color: ${Ve??""}`),J(Ce,"aria-label",t(de).direction),R(De,Ue),R(Pe,`[${t(de).component??""}]`),R(Me,t(de).subject),R(Be,t(de).summary)},[()=>H(t(de).timestamp),()=>({published:t(de).direction==="published",received:t(de).direction==="received",processed:t(de).direction==="processed"}),()=>h(t(de).direction),()=>g(t(de).direction)]),i(ne,me)}),a(le),i(B,le)};M(se,B=>{t(j).length===0?B(ve):B(ge,!1)})}a(ae),$e(ae,B=>A=B,()=>A),a(q),lt(O,()=>t(l),B=>c(l,B)),lt(ie,()=>t(v),B=>c(v,B)),lt(re,()=>t(w),B=>c(w,B)),At(p,()=>t(y),B=>c(y,B)),i(o,q),ke()}Te(["click"]);function nn(o,e){e()}var on=d('<button class="refresh-button svelte-1wgk637" data-testid="manual-refresh-button" aria-label="Refresh metrics now">Refresh</button>'),ln=d('<div class="last-updated svelte-1wgk637" data-testid="last-updated"> </div>'),vn=d('<div class="error-message svelte-1wgk637" role="alert"><span class="error-icon svelte-1wgk637">‚ö†</span> <span> </span></div>'),dn=d('<div class="empty-state svelte-1wgk637"><p class="svelte-1wgk637">No metrics available</p></div>'),cn=d('<tr data-testid="metrics-row" class="svelte-1wgk637"><td class="component-name svelte-1wgk637"> </td><td class="metric-value svelte-1wgk637"> </td><td> </td><td class="metric-value svelte-1wgk637"> </td><td class="metric-value svelte-1wgk637"> </td><td class="status-cell svelte-1wgk637"><span class="status-indicator svelte-1wgk637" data-testid="status-indicator">‚óè</span></td></tr>'),un=d('<table aria-label="Component metrics" class="svelte-1wgk637"><thead class="svelte-1wgk637"><tr><th scope="col" class="svelte-1wgk637">Component</th><th scope="col" class="svelte-1wgk637">Msg/sec</th><th scope="col" class="svelte-1wgk637">Errors/sec</th><th scope="col" class="svelte-1wgk637">CPU</th><th scope="col" class="svelte-1wgk637">Memory</th><th scope="col" class="svelte-1wgk637">Status</th></tr></thead><tbody class="svelte-1wgk637"></tbody></table>'),fn=d('<div class="metrics-tab svelte-1wgk637" data-testid="metrics-tab"><div class="control-bar svelte-1wgk637"><div class="refresh-control svelte-1wgk637"><label for="refresh-rate" class="svelte-1wgk637"><span class="control-label svelte-1wgk637">Refresh:</span> <select id="refresh-rate" data-testid="refresh-rate-selector" aria-label="Refresh rate" class="svelte-1wgk637"><option>Every 1s</option><option>Every 2s</option><option>Every 5s</option><option>Every 10s</option><option>Manual</option></select></label> <!></div> <!></div> <!> <div class="table-container svelte-1wgk637"><!></div></div>');function gn(o,e){we(e,!0);let r=oe(2e3),l=oe(null),v=oe(null),y=oe(null);const w=U(()=>t(l)?.components.slice().sort((f,T)=>f.name.localeCompare(T.name))||[]);function C(f){return f.toLocaleString("en-US")}function F(f){return`${(f/1048576).toFixed(2)} MB`}function A(f){return`${f.toFixed(1)}%`}function S(f){return f.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function u(f){return{healthy:"var(--status-success)",degraded:"var(--status-warning)",error:"var(--status-error)"}[f]}function j(f){return{healthy:"Healthy - No errors",degraded:"Degraded - Some errors detected",error:"Error - High error rate"}[f]}async function H(){try{const f=await fetch(`/flowbuilder/flows/${e.flowId}/runtime/metrics`);if(!f.ok)throw new Error(`HTTP ${f.status}: ${f.statusText}`);const T=await f.json();c(l,T,!0),c(v,new Date,!0),c(y,null)}catch(f){c(y,"Metrics unavailable - backend endpoint not ready"),console.warn("[MetricsTab] Metrics fetch failed:",f)}}Fe(()=>{if(!e.isActive||t(r)==="manual")return;H();const f=setInterval(H,t(r));return()=>{clearInterval(f)}});var g=fn(),h=s(g),m=s(h),E=s(m),q=n(s(E),2),P=s(q);P.value=P.__value=1e3;var x=n(P);x.value=x.__value=2e3;var _=n(x);_.value=_.__value=5e3;var O=n(_);O.value=O.__value=1e4;var Y=n(O);Y.value=Y.__value="manual",a(q),a(E);var L=n(E,2);{var G=f=>{var T=on();T.__click=[nn,H],i(f,T)};M(L,f=>{t(r)==="manual"&&f(G)})}a(m);var ie=n(m,2);{var ee=f=>{var T=ln(),I=s(T);a(T),V(N=>R(I,`Last: ${N??""}`),[()=>S(t(v))]),i(f,T)};M(ie,f=>{t(v)&&f(ee)})}a(h);var z=n(h,2);{var k=f=>{var T=vn(),I=n(s(T),2),N=s(I,!0);a(I),a(T),V(()=>R(N,t(y))),i(f,T)};M(z,f=>{t(y)&&f(k)})}var D=n(z,2),K=s(D);{var re=f=>{var T=dn();i(f,T)},b=f=>{var T=he(),I=ue(T);{var N=Z=>{var $=un(),ce=n(s($));Se(ce,21,()=>t(w),Q=>Q.name,(Q,p)=>{var W=cn(),te=s(W),ae=s(te,!0);a(te);var se=n(te),ve=s(se,!0);a(se);var ge=n(se);let B;var le=s(ge,!0);a(ge);var ne=n(ge),de=s(ne,!0);a(ne);var me=n(ne),ye=s(me,!0);a(me);var xe=n(me),Re=s(xe);a(xe),a(W),V((Ce,He,De,qe,Pe,je,Me)=>{R(ae,t(p).name),R(ve,Ce),B=Ee(ge,1,"metric-value svelte-1wgk637",null,B,He),R(le,De),R(de,qe),R(ye,Pe),Le(Re,`color: ${je??""}`),J(Re,"aria-label",Me)},[()=>C(t(p).throughput),()=>({"has-errors":t(p).errorRate>0}),()=>C(t(p).errorRate),()=>t(p).cpu!==void 0?A(t(p).cpu):"N/A",()=>t(p).memory!==void 0?F(t(p).memory):"N/A",()=>u(t(p).status),()=>j(t(p).status)]),i(Q,W)}),a(ce),a($),i(Z,$)};M(I,Z=>{t(w).length>0&&Z(N)},!0)}i(f,T)};M(K,f=>{t(w).length===0&&!t(y)?f(re):f(b,!1)})}a(D),a(g),lt(q,()=>t(r),f=>c(r,f)),i(o,g),ke()}Te(["click"]);var _n=d('<div class="error-message svelte-1fy36ri" role="alert" data-testid="health-error"><span class="error-icon svelte-1fy36ri">‚ö†</span> <span> </span></div>'),mn=d('<div class="health-summary svelte-1fy36ri" data-testid="health-summary"><span class="overall-status svelte-1fy36ri"><span class="status-icon svelte-1fy36ri"> </span> <span class="status-text svelte-1fy36ri">System Health:</span> <span class="health-count svelte-1fy36ri"> </span></span></div>'),hn=d('<div class="empty-state svelte-1fy36ri"><p class="svelte-1fy36ri">No health data available</p></div>'),bn=(o,e,r)=>e(t(r).name),pn=d('<button class="expand-button svelte-1fy36ri" data-testid="expand-button"> </button>'),yn=d('<tr class="details-row svelte-1fy36ri" data-testid="details-row"><td colspan="4" class="svelte-1fy36ri"><div class="details-content svelte-1fy36ri"><div><span class="severity-label svelte-1fy36ri"> </span> <span class="severity-message svelte-1fy36ri"> </span></div> <div class="detail-timestamp svelte-1fy36ri"> </div></div></td></tr>'),wn=d('<tr data-testid="health-row"><td class="component-name svelte-1fy36ri"><!> <span class="name-text svelte-1fy36ri"> </span></td><td class="status-cell svelte-1fy36ri"><span class="status-indicator svelte-1fy36ri" data-testid="status-indicator"> </span> <span class="status-label svelte-1fy36ri"> </span></td><td class="uptime-cell svelte-1fy36ri"><span class="uptime-value svelte-1fy36ri"> </span></td><td><span class="activity-value svelte-1fy36ri"> </span></td></tr> <!>',1),kn=d('<table aria-label="Component health status" class="svelte-1fy36ri"><thead class="svelte-1fy36ri"><tr><th scope="col" class="col-component svelte-1fy36ri">Component</th><th scope="col" class="col-status svelte-1fy36ri">Status</th><th scope="col" class="col-uptime svelte-1fy36ri">Uptime</th><th scope="col" class="col-activity svelte-1fy36ri">Last Activity</th></tr></thead><tbody class="svelte-1fy36ri"></tbody></table>'),Sn=d('<div class="health-tab svelte-1fy36ri" data-testid="health-tab"><!> <!> <div class="table-container svelte-1fy36ri"><!></div></div>');function xn(o,e){we(e,!0);let r=oe(null),l=oe(ze(new Date)),v=new ft,y=oe(null);const w=U(()=>t(r)?.components.slice().sort((z,k)=>z.name.localeCompare(k.name))||[]),C=U(()=>z=>v.has(z));function F(z,k){const D=new Date(z),K=Math.floor((k.getTime()-D.getTime())/1e3),re=Math.floor(K/3600),b=Math.floor(K%3600/60),f=K%60;return`${re.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`}function A(z,k){const D=new Date(z),K=Math.floor((k.getTime()-D.getTime())/1e3);if(K<60)return`${K} ${K===1?"second":"seconds"} ago`;if(K<3600){const b=Math.floor(K/60);return`${b} ${b===1?"minute":"minutes"} ago`}if(K<86400){const b=Math.floor(K/3600);return`${b} ${b===1?"hour":"hours"} ago`}const re=Math.floor(K/86400);return`${re} ${re===1?"day":"days"} ago`}function S(z,k){const D=new Date(z);return Math.floor((k.getTime()-D.getTime())/1e3)>30}function u(z){return{running:"var(--status-success)",degraded:"var(--status-warning)",error:"var(--status-error)"}[z]}function j(z){return{running:"‚óè",degraded:"‚ö†",error:"‚óè"}[z]}function H(z){return{running:"Running - Component is healthy",degraded:"Degraded - Component has warnings",error:"Error - Component has critical issues"}[z]}function g(z){return{healthy:"var(--status-success)",degraded:"var(--status-warning)",error:"var(--status-error)"}[z]}function h(z){return{healthy:"üü¢",degraded:"üü°",error:"üî¥"}[z]}function m(z){v.has(z)?v.delete(z):v.add(z)}function E(z){try{return new Date(z).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return z}}async function q(){try{const z=await fetch(`/flowbuilder/flows/${e.flowId}/runtime/health`);if(!z.ok)throw new Error(`HTTP ${z.status}: ${z.statusText}`);const k=await z.json();c(r,k,!0),c(y,null)}catch(z){c(y,"Health monitoring unavailable - backend endpoint not ready"),console.warn("[HealthTab] Health fetch failed:",z)}}Fe(()=>{if(!e.isActive)return;q();const z=setInterval(q,5e3);return()=>{clearInterval(z)}}),Fe(()=>{if(!e.isActive)return;const z=setInterval(()=>{c(l,new Date,!0)},1e3);return()=>{clearInterval(z)}});var P=Sn(),x=s(P);{var _=z=>{var k=_n(),D=n(s(k),2),K=s(D,!0);a(D),a(k),V(()=>R(K,t(y))),i(z,k)};M(x,z=>{t(y)&&z(_)})}var O=n(x,2);{var Y=z=>{var k=mn(),D=s(k),K=s(D),re=s(K,!0);a(K);var b=n(K,4),f=s(b);a(b),a(D),a(k),V((T,I)=>{Le(D,`color: ${T??""}`),J(D,"aria-label",`Overall system health: ${t(r).overall.status??""}`),R(re,I),R(f,`${t(r).overall.healthyCount??""}/${t(r).overall.totalCount??""} components healthy`)},[()=>g(t(r).overall.status),()=>h(t(r).overall.status)]),i(z,k)};M(O,z=>{t(r)?.overall&&z(Y)})}var L=n(O,2),G=s(L);{var ie=z=>{var k=hn();i(z,k)},ee=z=>{var k=he(),D=ue(k);{var K=re=>{var b=kn(),f=n(s(b));Se(f,21,()=>t(w),T=>T.name,(T,I)=>{var N=wn(),Z=ue(N);let $;var ce=s(Z),Q=s(ce);{var p=De=>{var qe=pn();qe.__click=[bn,m,I];var Pe=s(qe,!0);a(qe),V((je,Me,Ae)=>{J(qe,"aria-expanded",je),J(qe,"aria-label",Me),R(Pe,Ae)},[()=>t(C)(t(I).name),()=>t(C)(t(I).name)?`Collapse details for ${t(I).name}`:`Expand details for ${t(I).name}`,()=>t(C)(t(I).name)?"‚ñº":"‚ñ∂"]),i(De,qe)};M(Q,De=>{t(I).details&&De(p)})}var W=n(Q,2),te=s(W,!0);a(W),a(ce);var ae=n(ce),se=s(ae),ve=s(se,!0);a(se);var ge=n(se,2),B=s(ge,!0);a(ge),a(ae);var le=n(ae),ne=s(le),de=s(ne,!0);a(ne),a(le);var me=n(le);let ye;var xe=s(me),Re=s(xe,!0);a(xe),a(me),a(Z);var Ce=n(Z,2);{var He=De=>{var qe=yn(),Pe=s(qe),je=s(Pe),Me=s(je);let Ae;var Be=s(Me),vt=s(Be);a(Be);var rt=n(Be,2),Je=s(rt,!0);a(rt),a(Me);var st=n(Me,2),Ie=s(st);a(st),a(je),a(Pe),a(qe),V((Oe,Ve,Ue)=>{Ae=Ee(Me,1,"detail-severity svelte-1fy36ri",null,Ae,Oe),R(vt,`${Ve??""}:`),R(Je,t(I).details.message),R(Ie,`Occurred: ${Ue??""}`)},[()=>({"is-error":t(I).details.severity==="error"}),()=>t(I).details.severity.toUpperCase(),()=>E(t(I).details.timestamp)]),i(De,qe)};M(Ce,De=>{t(I).details&&t(C)(t(I).name)&&De(He)})}V((De,qe,Pe,je,Me,Ae,Be)=>{$=Ee(Z,1,"svelte-1fy36ri",null,$,De),R(te,t(I).name),Le(se,`color: ${qe??""}`),J(se,"aria-label",Pe),R(ve,je),R(B,t(I).status),R(de,Me),ye=Ee(me,1,"activity-cell svelte-1fy36ri",null,ye,Ae),R(Re,Be)},[()=>({"has-details":t(I).details!==null}),()=>u(t(I).status),()=>H(t(I).status),()=>j(t(I).status),()=>F(t(I).startTime,t(l)),()=>({stale:S(t(I).lastActivity,t(l))}),()=>A(t(I).lastActivity,t(l))]),i(T,N)}),a(f),a(b),i(re,b)};M(D,re=>{t(w).length>0&&re(K)},!0)}i(z,k)};M(G,z=>{t(w).length===0&&!t(y)?z(ie):z(ee,!1)})}a(L),a(P),i(o,P),ke()}Te(["click"]);var Cn=(o,e)=>e("logs"),qn=(o,e)=>e("messages"),zn=(o,e)=>e("metrics"),En=(o,e)=>e("health"),Tn=d('<div id="logs-panel" role="tabpanel" aria-labelledby="tab-logs" class="tab-content svelte-1v0suwy" data-testid="logs-panel"><!></div>'),Rn=d('<div id="messages-panel" role="tabpanel" aria-labelledby="tab-messages" class="tab-content svelte-1v0suwy" data-testid="messages-panel"><!></div>'),Dn=d('<div id="metrics-panel" role="tabpanel" aria-labelledby="tab-metrics" class="tab-content svelte-1v0suwy" data-testid="metrics-panel"><!></div>'),Fn=d('<div id="health-panel" role="tabpanel" aria-labelledby="tab-health" class="tab-content svelte-1v0suwy" data-testid="health-panel"><!></div>'),jn=d('<div class="runtime-panel svelte-1v0suwy" data-testid="runtime-panel"><header class="svelte-1v0suwy"><div class="header-content svelte-1v0suwy"><h3 class="svelte-1v0suwy">Runtime Debugging</h3> <div class="tab-nav svelte-1v0suwy" role="tablist" aria-label="Runtime debugging tabs"><button role="tab" id="tab-logs" aria-controls="logs-panel" data-testid="tab-logs">Logs</button> <button role="tab" id="tab-messages" aria-controls="messages-panel" data-testid="tab-messages">Messages</button> <button role="tab" id="tab-metrics" aria-controls="metrics-panel" data-testid="tab-metrics">Metrics</button> <button role="tab" id="tab-health" aria-controls="health-panel" data-testid="tab-health">Health</button></div></div> <button class="close-button svelte-1v0suwy" aria-label="Close runtime panel">‚úï</button></header> <div class="panel-body svelte-1v0suwy"><!></div></div>');function Mn(o,e){we(e,!0);let r=be(e,"isOpen",3,!1),l=be(e,"height",3,300),v=oe("logs");function y(S){S.key==="Escape"&&r()&&(S.preventDefault(),e.onClose?.())}function w(S){c(v,S,!0)}var C=he();Qe("keydown",bt,y);var F=ue(C);{var A=S=>{var u=jn(),j=s(u),H=s(j),g=n(s(H),2),h=s(g);let m;h.__click=[Cn,w];var E=n(h,2);let q;E.__click=[qn,w];var P=n(E,2);let x;P.__click=[zn,w];var _=n(P,2);let O;_.__click=[En,w],a(g),a(H);var Y=n(H,2);Y.__click=function(...z){e.onClose?.apply(this,z)},a(j);var L=n(j,2),G=s(L);{var ie=z=>{var k=Tn(),D=s(k);{let K=U(()=>t(v)==="logs");Bs(D,{get flowId(){return e.flowId},get isActive(){return t(K)}})}a(k),i(z,k)},ee=z=>{var k=he(),D=ue(k);{var K=b=>{var f=Rn(),T=s(f);{let I=U(()=>t(v)==="messages");sn(T,{get flowId(){return e.flowId},get isActive(){return t(I)}})}a(f),i(b,f)},re=b=>{var f=he(),T=ue(f);{var I=Z=>{var $=Dn(),ce=s($);{let Q=U(()=>t(v)==="metrics");gn(ce,{get flowId(){return e.flowId},get isActive(){return t(Q)}})}a($),i(Z,$)},N=Z=>{var $=he(),ce=ue($);{var Q=p=>{var W=Fn(),te=s(W);{let ae=U(()=>t(v)==="health");xn(te,{get flowId(){return e.flowId},get isActive(){return t(ae)}})}a(W),i(p,W)};M(ce,p=>{t(v)==="health"&&p(Q)},!0)}i(Z,$)};M(T,Z=>{t(v)==="metrics"?Z(I):Z(N,!1)},!0)}i(b,f)};M(D,b=>{t(v)==="messages"?b(K):b(re,!1)},!0)}i(z,k)};M(G,z=>{t(v)==="logs"?z(ie):z(ee,!1)})}a(L),a(u),V((z,k,D,K)=>{Le(u,`height: ${l()??""}px;`),J(h,"aria-selected",t(v)==="logs"),m=Ee(h,1,"tab-button svelte-1v0suwy",null,m,z),J(E,"aria-selected",t(v)==="messages"),q=Ee(E,1,"tab-button svelte-1v0suwy",null,q,k),J(P,"aria-selected",t(v)==="metrics"),x=Ee(P,1,"tab-button svelte-1v0suwy",null,x,D),J(_,"aria-selected",t(v)==="health"),O=Ee(_,1,"tab-button svelte-1v0suwy",null,O,K)},[()=>({active:t(v)==="logs"}),()=>({active:t(v)==="messages"}),()=>({active:t(v)==="metrics"}),()=>({active:t(v)==="health"})]),i(S,u)};M(F,S=>{r()&&S(A)})}i(o,C),ke()}Te(["click"]);var On=d('<button type="button" data-testid="validation-status" aria-label="View validation details"><span class="status-icon svelte-djbjik"> </span> <span class="status-text svelte-djbjik"> </span></button>'),In=d('<span role="img"> </span> <span class="status-text svelte-djbjik"> </span>',1),Pn=d('<span role="img"> </span> <span class="status-text svelte-djbjik"> </span>',1),An=d('<span role="img"> </span> <span class="status-text svelte-djbjik"> </span>',1),Hn=d('<span role="img"> </span> <span class="status-text svelte-djbjik"> </span>',1),Nn=d('<span class="timestamp svelte-djbjik"> </span>'),Vn=d('<button type="button" class="save-button svelte-djbjik" aria-label="Save flow">Save</button>'),Ln=d('<div class="error-message svelte-djbjik" role="alert"> </div>'),Bn=d('<div id="save-status" class="save-status-indicator save-status svelte-djbjik"><div class="status-content svelte-djbjik"><!> <!> <!> <!></div> <!></div>');function Un(o,e){we(e,!0);function r(q){return q?new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit"}).format(q):""}const l=U(()=>{switch(e.saveState.status){case"clean":return{text:"Valid",icon:"‚úì",class:"status-clean"};case"draft":return{text:`Draft - ${e.saveState.error||"has errors"}`,icon:"‚ö†",class:"status-draft"};case"dirty":return{text:"Unsaved changes",icon:"‚óè",class:"status-dirty"};case"saving":return{text:"Saving...",icon:"‚ü≥",class:"status-saving"};case"error":return{text:"Save failed",icon:"‚ö†",class:"status-error"}}}),v=U(()=>{if(!e.validationResult)return{text:"Validating...",icon:"‚ü≥",class:"validation-validating"};if(e.validationResult.errors.length>0){const q=e.validationResult.errors.length;return{text:`Draft - ${q} error${q>1?"s":""}`,icon:"‚ùå",class:"validation-error"}}if(e.validationResult.warnings.length>0){const q=e.validationResult.warnings.length;return{text:`${q} warning${q>1?"s":""}`,icon:"‚ö†Ô∏è",class:"validation-warning"}}return{text:"Valid",icon:"‚úì",class:"validation-valid"}});var y=Bn(),w=s(y),C=s(w);{var F=q=>{var P=On();P.__click=function(...L){e.onValidationClick?.apply(this,L)};var x=s(P),_=s(x,!0);a(x);var O=n(x,2),Y=s(O,!0);a(O),a(P),V(()=>{Ee(P,1,`validation-status ${t(v).class??""}`,"svelte-djbjik"),R(_,t(v).icon),R(Y,t(v).text)}),i(q,P)};M(C,q=>{e.validationResult!==void 0&&q(F)})}var A=n(C,2);{var S=q=>{var P=In(),x=ue(P),_=s(x,!0);a(x);var O=n(x,2),Y=s(O,!0);a(O),V(()=>{Ee(x,1,`status-icon ${t(l).class??""}`,"svelte-djbjik"),J(x,"aria-label",t(l).text),R(_,t(l).icon),R(Y,t(l).text)}),i(q,P)},u=q=>{var P=he(),x=ue(P);{var _=Y=>{var L=Pn(),G=ue(L),ie=s(G,!0);a(G);var ee=n(G,2),z=s(ee,!0);a(ee),V(()=>{Ee(G,1,`status-icon ${t(l).class??""}`,"svelte-djbjik"),J(G,"aria-label",t(l).text),R(ie,t(l).icon),R(z,t(l).text)}),i(Y,L)},O=Y=>{var L=he(),G=ue(L);{var ie=z=>{var k=An(),D=ue(k),K=s(D,!0);a(D);var re=n(D,2),b=s(re,!0);a(re),V(()=>{Ee(D,1,`status-icon ${t(l).class??""}`,"svelte-djbjik"),J(D,"aria-label",t(l).text),R(K,t(l).icon),R(b,t(l).text)}),i(z,k)},ee=z=>{var k=he(),D=ue(k);{var K=re=>{var b=Hn(),f=ue(b),T=s(f,!0);a(f);var I=n(f,2),N=s(I,!0);a(I),V(()=>{Ee(f,1,`status-icon ${t(l).class??""}`,"svelte-djbjik"),J(f,"aria-label",t(l).text),R(T,t(l).icon),R(N,t(l).text)}),i(re,b)};M(D,re=>{e.saveState.status==="error"&&re(K)},!0)}i(z,k)};M(G,z=>{e.saveState.status==="saving"?z(ie):z(ee,!1)},!0)}i(Y,L)};M(x,Y=>{e.saveState.status==="dirty"?Y(_):Y(O,!1)},!0)}i(q,P)};M(A,q=>{e.saveState.status==="draft"?q(S):q(u,!1)})}var j=n(A,2);{var H=q=>{var P=Nn(),x=s(P);a(P),V(_=>R(x,`saved at ${_??""}`),[()=>r(e.saveState.lastSaved)]),i(q,P)};M(j,q=>{e.saveState.lastSaved&&(e.saveState.status==="clean"||e.saveState.status==="draft")&&q(H)})}var g=n(j,2);{var h=q=>{var P=Vn();P.__click=function(...x){e.onSave?.apply(this,x)},V(()=>P.disabled=e.saveState.status==="clean"||e.saveState.status==="draft"||e.saveState.status==="saving"),i(q,P)};M(g,q=>{e.onSave&&q(h)})}a(w);var m=n(w,2);{var E=q=>{var P=Ln(),x=s(P,!0);a(P),V(()=>R(x,e.saveState.error)),i(q,P)};M(m,q=>{e.saveState.status==="error"&&e.saveState.error&&q(E)})}a(y),V(()=>J(y,"data-status",e.saveState.status)),i(o,y),ke()}Te(["click"]);function Wn(o,e){we(e,!0);let r=be(e,"showDialog",15,!1),l=oe(null),v=oe(!1);Fe(()=>(e.saveState.status==="dirty"?window.onbeforeunload=A=>(A.preventDefault(),A.returnValue="",""):window.onbeforeunload=null,()=>{window.onbeforeunload=null})),Bt(({to:F,cancel:A})=>{if(t(v)){c(v,!1);return}e.saveState.status==="dirty"&&F&&(A(),c(l,{url:F.url.pathname},!0),r(!0),e.onShowDialog?.(!0))});function y(){if(t(l)){const F=t(l).url;c(l,null),r(!1),e.onShowDialog?.(!1),e.onNavigationAllowed?.(),c(v,!0),Ut(F)}}function w(){c(l,null),r(!1),e.onShowDialog?.(!1)}var C={allowNavigation:y,cancelNavigation:w};return ke(C)}function Yn(o,e){o.target===o.currentTarget&&e.onCancel?.()}function Jn(o,e){(o.key==="Enter"||o.key===" ")&&o.target===o.currentTarget&&(o.preventDefault(),e.onCancel?.())}var Xn=d('<div class="dialog-overlay svelte-1nrguxe" role="dialog" aria-modal="true" aria-labelledby="navigation-dialog-title" tabindex="-1"><div class="dialog-content svelte-1nrguxe"><h2 id="navigation-dialog-title" class="svelte-1nrguxe">You have unsaved changes</h2> <p class="svelte-1nrguxe">You have unsaved changes. Are you sure you want to leave?</p> <div class="dialog-actions svelte-1nrguxe"><button type="button" class="button-save svelte-1nrguxe">Save Changes</button> <button type="button" class="button-discard svelte-1nrguxe">Discard Changes</button> <button type="button" class="button-cancel svelte-1nrguxe">Cancel</button></div></div></div>');function Kn(o,e){we(e,!0);function r(w){w.key==="Escape"&&e.isOpen&&e.onCancel?.()}var l=he();Qe("keydown",bt,r);var v=ue(l);{var y=w=>{var C=Xn();C.__click=[Yn,e],C.__keydown=[Jn,e];var F=s(C),A=n(s(F),4),S=s(A);S.__click=function(...H){e.onSave?.apply(this,H)};var u=n(S,2);u.__click=function(...H){e.onDiscard?.apply(this,H)};var j=n(u,2);j.__click=function(...H){e.onCancel?.apply(this,H)},a(A),a(F),a(C),i(w,C)};M(v,w=>{e.isOpen&&w(y)})}i(o,l),ke()}Te(["click","keydown"]);function Zn(o,e){o.target===o.currentTarget&&e.onClose()}var Gn=d("<strong> </strong>"),Qn=d('<li class="svelte-pna667"> </li>'),$n=d('<div class="suggestions svelte-pna667"><strong>Suggestions:</strong> <ul class="svelte-pna667"></ul></div>'),eo=d('<li class="error-item svelte-pna667"><div class="issue-message svelte-pna667"><!> </div> <!></li>'),to=d('<div class="issue-group svelte-pna667"><h4 class="svelte-pna667"> </h4> <ul class="svelte-pna667"></ul></div>'),ao=d('<section class="errors-section svelte-pna667"><h3 class="svelte-pna667"> </h3> <p class="section-description svelte-pna667">These issues must be fixed before deployment:</p> <!></section>'),ro=d("<strong> </strong>"),so=d('<li class="svelte-pna667"> </li>'),no=d('<div class="suggestions svelte-pna667"><strong>Suggestions:</strong> <ul class="svelte-pna667"></ul></div>'),oo=d('<li class="warning-item svelte-pna667"><div class="issue-message svelte-pna667"><!> </div> <!></li>'),lo=d('<div class="issue-group svelte-pna667"><h4 class="svelte-pna667"> </h4> <ul class="svelte-pna667"></ul></div>'),io=d(`<section class="warnings-section svelte-pna667"><h3 class="svelte-pna667"> </h3> <p class="section-description svelte-pna667">These issues won't block deployment but should be reviewed:</p> <!></section>`),vo=d('<div class="dialog-overlay svelte-pna667" role="dialog" aria-modal="true" aria-labelledby="dialog-title" tabindex="-1"><div class="dialog-content svelte-pna667"><header class="dialog-header svelte-pna667"><h2 id="dialog-title" class="svelte-pna667">Flow Validation Failed</h2> <button class="close-button svelte-pna667" aria-label="Close dialog">√ó</button></header> <div class="dialog-body svelte-pna667"><!> <!></div> <footer class="dialog-footer svelte-pna667"><button class="primary-button svelte-pna667">Close and Edit Flow</button></footer></div></div>');function co(o,e){we(e,!0);let r=oe(void 0);function l(S){S.key==="Escape"&&e.isOpen&&e.onClose()}Fe(()=>{e.isOpen&&t(r)&&t(r).querySelector(".primary-button")?.focus()});function v(S){const u=new it;for(const j of S){const H=j.component_name;u.has(H)||u.set(H,[]),u.get(H).push(j)}return u}let y=U(()=>e.validationResult?v(e.validationResult.errors):new it),w=U(()=>e.validationResult?v(e.validationResult.warnings):new it);var C=he();Qe("keydown",bt,l);var F=ue(C);{var A=S=>{var u=vo();u.__click=[Zn,e],u.__keydown=l;var j=s(u),H=s(j),g=n(s(H),2);g.__click=function(...O){e.onClose?.apply(this,O)},a(H);var h=n(H,2),m=s(h);{var E=O=>{var Y=ao(),L=s(Y),G=s(L);a(L);var ie=n(L,4);Se(ie,17,()=>[...t(y).entries()],([ee,z])=>ee,(ee,z)=>{var k=U(()=>tt(t(z),2));let D=()=>t(k)[0],K=()=>t(k)[1];var re=to(),b=s(re),f=s(b,!0);a(b);var T=n(b,2);Se(T,23,K,(I,N)=>`${I.component_name}-${I.port_name||"main"}-${I.type}-${N}`,(I,N)=>{var Z=eo(),$=s(Z),ce=s($);{var Q=ae=>{var se=Gn(),ve=s(se);a(se),V(()=>R(ve,`${t(N).port_name??""}:`)),i(ae,se)};M(ce,ae=>{t(N).port_name&&ae(Q)})}var p=n(ce);a($);var W=n($,2);{var te=ae=>{var se=$n(),ve=n(s(se),2);Se(ve,23,()=>t(N).suggestions,(ge,B)=>`${t(N).component_name}-${t(N).type}-suggestion-${B}`,(ge,B)=>{var le=Qn(),ne=s(le,!0);a(le),V(()=>R(ne,t(B))),i(ge,le)}),a(ve),a(se),i(ae,se)};M(W,ae=>{t(N).suggestions&&t(N).suggestions.length>0&&ae(te)})}a(Z),V(()=>R(p,` ${t(N).message??""}`)),i(I,Z)}),a(T),a(re),V(()=>R(f,D())),i(ee,re)}),a(Y),V(()=>R(G,`‚ùå Errors (${e.validationResult.errors.length??""})`)),i(O,Y)};M(m,O=>{e.validationResult.errors.length>0&&O(E)})}var q=n(m,2);{var P=O=>{var Y=io(),L=s(Y),G=s(L);a(L);var ie=n(L,4);Se(ie,17,()=>[...t(w).entries()],([ee,z])=>ee,(ee,z)=>{var k=U(()=>tt(t(z),2));let D=()=>t(k)[0],K=()=>t(k)[1];var re=lo(),b=s(re),f=s(b,!0);a(b);var T=n(b,2);Se(T,23,K,(I,N)=>`${I.component_name}-${I.port_name||"main"}-${I.type}-${N}`,(I,N)=>{var Z=oo(),$=s(Z),ce=s($);{var Q=ae=>{var se=ro(),ve=s(se);a(se),V(()=>R(ve,`${t(N).port_name??""}:`)),i(ae,se)};M(ce,ae=>{t(N).port_name&&ae(Q)})}var p=n(ce);a($);var W=n($,2);{var te=ae=>{var se=no(),ve=n(s(se),2);Se(ve,23,()=>t(N).suggestions,(ge,B)=>`${t(N).component_name}-${t(N).type}-suggestion-${B}`,(ge,B)=>{var le=so(),ne=s(le,!0);a(le),V(()=>R(ne,t(B))),i(ge,le)}),a(ve),a(se),i(ae,se)};M(W,ae=>{t(N).suggestions&&t(N).suggestions.length>0&&ae(te)})}a(Z),V(()=>R(p,` ${t(N).message??""}`)),i(I,Z)}),a(T),a(re),V(()=>R(f,D())),i(ee,re)}),a(Y),V(()=>R(G,`‚ö†Ô∏è Warnings (${e.validationResult.warnings.length??""})`)),i(O,Y)};M(q,O=>{e.validationResult.warnings.length>0&&O(P)})}a(h);var x=n(h,2),_=s(x);_.__click=function(...O){e.onClose?.apply(this,O)},a(x),a(j),a(u),$e(u,O=>c(r,O),()=>t(r)),i(S,u)};M(F,S=>{e.isOpen&&e.validationResult&&S(A)})}i(o,C),ke()}Te(["click","keydown"]);function uo(o,e){o.target===o.currentTarget&&e.onClose()}var fo=d("<strong> </strong>"),go=d('<div class="suggestion svelte-11plyrw"><strong>üí° Suggestion:</strong> </div>'),_o=d('<li class="error-item svelte-11plyrw"><div class="error-detail svelte-11plyrw"><!> </div> <!></li>'),mo=d('<div class="error-group svelte-11plyrw"><h4 class="svelte-11plyrw"> </h4> <ul class="svelte-11plyrw"></ul></div>'),ho=d(`<div class="modal-overlay svelte-11plyrw" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1"><div class="modal-content svelte-11plyrw"><header class="modal-header svelte-11plyrw"><h2 id="modal-title" class="svelte-11plyrw">Cannot Deploy Flow</h2> <button class="close-button svelte-11plyrw" aria-label="Close modal">√ó</button></header> <div class="modal-body svelte-11plyrw"><div class="error-summary svelte-11plyrw"><span class="error-icon svelte-11plyrw">‚ùå</span> <p class="error-message svelte-11plyrw">This flow has <strong> </strong> that must
						be fixed before deployment.</p></div> <section class="errors-section svelte-11plyrw"><h3 class="svelte-11plyrw">Errors to Fix:</h3> <!></section></div> <footer class="modal-footer svelte-11plyrw"><button class="primary-button svelte-11plyrw">OK, I'll Fix These Errors</button></footer></div></div>`);function bo(o,e){we(e,!0);let r=oe(void 0);function l(S){S.key==="Escape"&&e.isOpen&&e.onClose()}Fe(()=>{e.isOpen&&t(r)&&t(r).querySelector(".primary-button")?.focus()});const v=U(()=>{if(!e.validationResult)return new it;const S=new it;for(const u of e.validationResult.errors){const j=u.component_name;S.has(j)||S.set(j,[]),S.get(j).push(u)}return S}),y=U(()=>Array.from(t(v).entries())),w=U(()=>e.validationResult?.errors.length||0);var C=he();Qe("keydown",bt,l);var F=ue(C);{var A=S=>{var u=ho();u.__click=[uo,e],u.__keydown=l;var j=s(u),H=s(j),g=n(s(H),2);g.__click=function(...L){e.onClose?.apply(this,L)},a(H);var h=n(H,2),m=s(h),E=n(s(m),2),q=n(s(E)),P=s(q);a(q),gt(),a(E),a(m);var x=n(m,2),_=n(s(x),2);Se(_,17,()=>t(y),([L,G])=>L,(L,G)=>{var ie=U(()=>tt(t(G),2));let ee=()=>t(ie)[0],z=()=>t(ie)[1];var k=mo(),D=s(k),K=s(D,!0);a(D);var re=n(D,2);Se(re,21,z,b=>b.port_name?`${ee()}-${b.port_name}`:`${ee()}-${b.message}`,(b,f)=>{var T=_o(),I=s(T),N=s(I);{var Z=p=>{var W=fo(),te=s(W);a(W),V(()=>R(te,`${t(f).port_name??""}:`)),i(p,W)};M(N,p=>{t(f).port_name&&p(Z)})}var $=n(N);a(I);var ce=n(I,2);{var Q=p=>{var W=he(),te=ue(W);Se(te,16,()=>t(f).suggestions,ae=>ae,(ae,se)=>{var ve=go(),ge=n(s(ve));a(ve),V(()=>R(ge,` ${se??""}`)),i(ae,ve)}),i(p,W)};M(ce,p=>{t(f).suggestions&&t(f).suggestions.length>0&&p(Q)})}a(T),V(()=>R($,` ${t(f).message??""}`)),i(b,T)}),a(re),a(k),V(()=>R(K,ee())),i(L,k)}),a(x),a(h);var O=n(h,2),Y=s(O);Y.__click=function(...L){e.onClose?.apply(this,L)},a(O),a(j),a(u),$e(u,L=>c(r,L),()=>t(r)),V(()=>R(P,`${t(w)??""} error${t(w)>1?"s":""}`)),i(S,u)};M(F,S=>{e.isOpen&&e.validationResult&&t(w)>0&&S(A)})}i(o,C),ke()}Te(["click","keydown"]);function jt(o,e){o.target===o.currentTarget&&e.onClose()}function Mt(o,e){(o.key==="Enter"||o.key===" ")&&o.target===o.currentTarget&&(o.preventDefault(),e.onClose())}var po=o=>o.stopPropagation(),yo=o=>o.stopPropagation(),wo=d('<span class="port-name svelte-10mzki"> </span>'),ko=d('<div class="issue-suggestion svelte-10mzki"><span class="suggestion-icon svelte-10mzki">üí°</span> </div>'),So=d('<li class="issue-item error-item svelte-10mzki"><div class="issue-header svelte-10mzki"><strong class="component-name svelte-10mzki"> </strong> <!></div> <div class="issue-message svelte-10mzki"> </div> <!></li>'),xo=d('<section class="issues-section errors-section svelte-10mzki"><h3 class="section-title svelte-10mzki"><span class="section-icon svelte-10mzki">‚ùå</span> </h3> <ul class="issues-list svelte-10mzki"></ul></section>'),Co=d('<span class="port-name svelte-10mzki"> </span>'),qo=d('<div class="issue-suggestion svelte-10mzki"><span class="suggestion-icon svelte-10mzki">üí°</span> </div>'),zo=d('<li class="issue-item warning-item svelte-10mzki"><div class="issue-header svelte-10mzki"><strong class="component-name svelte-10mzki"> </strong> <!></div> <div class="issue-message svelte-10mzki"> </div> <!></li>'),Eo=d('<section class="issues-section warnings-section svelte-10mzki"><h3 class="section-title svelte-10mzki"><span class="section-icon svelte-10mzki">‚ö†Ô∏è</span> </h3> <ul class="issues-list svelte-10mzki"></ul></section>'),To=d('<div class="empty-state svelte-10mzki"><p class="svelte-10mzki">No validation issues found.</p></div>'),Ro=d('<div class="modal-backdrop svelte-10mzki" data-testid="modal-backdrop" role="presentation"><div class="modal-dialog svelte-10mzki" role="dialog" aria-label="Validation Details" tabindex="0"><div class="modal-header svelte-10mzki"><h2 class="svelte-10mzki">Validation Issues</h2> <button type="button" class="close-button svelte-10mzki" aria-label="Close">‚úï</button></div> <div class="modal-body svelte-10mzki"><!> <!> <!></div> <div class="modal-footer svelte-10mzki"><button type="button" class="button-primary svelte-10mzki">Close</button></div></div></div>'),Do=o=>o.stopPropagation(),Fo=o=>o.stopPropagation(),jo=d('<div class="modal-backdrop svelte-10mzki" data-testid="modal-backdrop" role="presentation"><div class="modal-dialog svelte-10mzki" role="dialog" aria-label="Validation Details" tabindex="0"><div class="modal-header svelte-10mzki"><h2 class="svelte-10mzki">Validation Details</h2> <button type="button" class="close-button svelte-10mzki" aria-label="Close">‚úï</button></div> <div class="modal-body svelte-10mzki"><div class="empty-state svelte-10mzki"><p class="svelte-10mzki">No validation results available.</p></div></div> <div class="modal-footer svelte-10mzki"><button type="button" class="button-primary svelte-10mzki">Close</button></div></div></div>');function Mo(o,e){we(e,!0);let r=oe(null),l=null;function v(S,u){if(e.validationResult?.nodes){if(S&&S.trim()!==""){const j=e.validationResult.nodes.find(H=>H.id===S);if(j)return j.name||j.id}if(u){const j=e.validationResult.nodes.find(H=>H.input_ports?.some(g=>g.name===u)||H.output_ports?.some(g=>g.name===u));if(j)return j.name||j.id}}return S&&S.trim()!==""?S:"Flow"}function y(S){if(S.key==="Escape"&&e.isOpen){e.onClose();return}if(S.key==="Tab"&&e.isOpen&&t(r)){const u=t(r).querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),j=Array.from(u);if(j.length===0)return;const H=j[0],g=j[j.length-1];S.shiftKey?document.activeElement===H&&(S.preventDefault(),g.focus()):document.activeElement===g&&(S.preventDefault(),H.focus())}}Fe(()=>{if(e.isOpen)return l=document.activeElement,document.addEventListener("keydown",y),setTimeout(()=>{if(t(r)){const S=t(r).querySelector("button");S?S.focus():t(r).focus()}},10),()=>{document.removeEventListener("keydown",y),l&&l.focus()}});var w=he(),C=ue(w);{var F=S=>{var u=Ro();u.__click=[jt,e],u.__keydown=[Mt,e];var j=s(u);j.__click=[po],j.__keydown=[yo];var H=s(j),g=n(s(H),2);g.__click=function(...L){e.onClose?.apply(this,L)},a(H);var h=n(H,2),m=s(h);{var E=L=>{var G=xo(),ie=s(G),ee=n(s(ie));a(ie);var z=n(ie,2);Se(z,23,()=>e.validationResult.errors,(k,D)=>k.component_name+"|"+(k.port_name??"")+"|"+k.message+"|"+D,(k,D)=>{var K=So(),re=s(K),b=s(re),f=s(b,!0);a(b);var T=n(b,2);{var I=Q=>{var p=wo(),W=s(p);a(p),V(()=>R(W,`Port: ${t(D).port_name??""}`)),i(Q,p)};M(T,Q=>{t(D).port_name&&Q(I)})}a(re);var N=n(re,2),Z=s(N,!0);a(N);var $=n(N,2);{var ce=Q=>{var p=ko(),W=n(s(p));a(p),V(()=>R(W,` ${t(D).suggestions[0]??""}`)),i(Q,p)};M($,Q=>{t(D).suggestions&&t(D).suggestions.length>0&&Q(ce)})}a(K),V(Q=>{R(f,Q),R(Z,t(D).message)},[()=>v(t(D).component_name,t(D).port_name)]),i(k,K)}),a(z),a(G),V(()=>R(ee,` Errors (${e.validationResult.errors.length??""})`)),i(L,G)};M(m,L=>{e.validationResult.errors.length>0&&L(E)})}var q=n(m,2);{var P=L=>{var G=Eo(),ie=s(G),ee=n(s(ie));a(ie);var z=n(ie,2);Se(z,23,()=>e.validationResult.warnings,(k,D)=>k.component_name+"|"+(k.port_name??"")+"|"+k.message+"|"+D,(k,D)=>{var K=zo(),re=s(K),b=s(re),f=s(b,!0);a(b);var T=n(b,2);{var I=Q=>{var p=Co(),W=s(p);a(p),V(()=>R(W,`Port: ${t(D).port_name??""}`)),i(Q,p)};M(T,Q=>{t(D).port_name&&Q(I)})}a(re);var N=n(re,2),Z=s(N,!0);a(N);var $=n(N,2);{var ce=Q=>{var p=qo(),W=n(s(p));a(p),V(()=>R(W,` ${t(D).suggestions[0]??""}`)),i(Q,p)};M($,Q=>{t(D).suggestions&&t(D).suggestions.length>0&&Q(ce)})}a(K),V(Q=>{R(f,Q),R(Z,t(D).message)},[()=>v(t(D).component_name,t(D).port_name)]),i(k,K)}),a(z),a(G),V(()=>R(ee,` Warnings (${e.validationResult.warnings.length??""})`)),i(L,G)};M(q,L=>{e.validationResult.warnings.length>0&&L(P)})}var x=n(q,2);{var _=L=>{var G=To();i(L,G)};M(x,L=>{e.validationResult.errors.length===0&&e.validationResult.warnings.length===0&&L(_)})}a(h);var O=n(h,2),Y=s(O);Y.__click=function(...L){e.onClose?.apply(this,L)},a(O),a(j),$e(j,L=>c(r,L),()=>t(r)),a(u),i(S,u)},A=S=>{var u=he(),j=ue(u);{var H=g=>{var h=jo();h.__click=[jt,e],h.__keydown=[Mt,e];var m=s(h);m.__click=[Do],m.__keydown=[Fo];var E=s(m),q=n(s(E),2);q.__click=function(..._){e.onClose?.apply(this,_)},a(E);var P=n(E,4),x=s(P);x.__click=function(..._){e.onClose?.apply(this,_)},a(P),a(m),$e(m,_=>c(r,_),()=>t(r)),a(h),i(g,h)};M(j,g=>{e.isOpen&&!e.validationResult&&g(H)},!0)}i(S,u)};M(C,S=>{e.isOpen&&e.validationResult?S(F):S(A,!1)})}i(o,w),ke()}Te(["click","keydown"]);class Nt extends Error{constructor(e,r){super(e),this.validationResult=r,this.name="ValidationError"}}async function Oo(o,e){const r=await fetch(`/flowbuilder/flows/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){const l=await r.json();throw new Error(l.error||"Save failed")}return await r.json()}async function Io(o){const e=await fetch(`/flowbuilder/deployment/${o}/deploy`,{method:"POST"});if(!e.ok){const r=await e.json();throw r.validation_result?new Nt(r.error||"Flow validation failed",r.validation_result):new Error(r.error||"Deploy failed")}return await e.json()}async function Po(o){const e=await fetch(`/flowbuilder/deployment/${o}/start`,{method:"POST"});if(!e.ok){const r=await e.json();throw new Error(r.error||"Start failed")}return await e.json()}async function Ao(o){const e=await fetch(`/flowbuilder/deployment/${o}/stop`,{method:"POST"});if(!e.ok){const r=await e.json();throw new Error(r.error||"Stop failed")}return await e.json()}function Ho(o){return o instanceof Nt}var No=d('<p class="svelte-1dk9wgy"> </p>'),Vo=d('<aside class="config-sidebar svelte-1dk9wgy"><!></aside>'),Lo=d('<!> <!> <!> <!> <!> <div class="editor-layout svelte-1dk9wgy"><aside class="palette-sidebar svelte-1dk9wgy"><!></aside> <main class="canvas-area svelte-1dk9wgy"><header class="editor-header svelte-1dk9wgy"><div class="header-content svelte-1dk9wgy"><a href="/" data-sveltekit-reload="" class="back-button svelte-1dk9wgy" aria-label="Back to flows">‚Üê Flows</a> <div class="header-text svelte-1dk9wgy"><h1 class="svelte-1dk9wgy"> </h1> <!></div> <!></div></header> <div class="canvas-container svelte-1dk9wgy"><!></div> <!> <!></main> <!></div>',1);function el(o,e){we(e,!0);let r=oe(ze(e.data.flow)),l=oe(!1),v=oe(null),y=oe(!1),w,C=oe(!1),F=oe(!1),A=oe(null),S=oe(!1),u=oe(!1),j=oe(null);const H=U(()=>t(j)?.validation_status!=="errors");let g=oe(!1),h=oe(ze({status:"clean",lastSaved:null,error:null})),m=oe(ze({state:e.data.flow.runtime_state,message:null,lastTransition:null})),E=oe(!1),q=300;function P(X){const fe=t(x).find(_e=>_e.id===X);fe&&c(v,{...fe.data.node,health:{status:"not_running",lastUpdated:new Date().toISOString()}},!0)}let x=oe(ze(Wa(t(r).nodes,P))),_=oe(ze(Ya(t(r).connections))),O=t(x).length,Y=t(_).length,L=!1;Fe(()=>{const X=t(x).length,fe=t(_).length;if(!(X===O&&fe===Y)){if(!L){O=X,Y=fe,L=!0;return}c(l,!0),c(h,{...t(h),status:"dirty"},!0),O=X,Y=fe}});let G=null,ie="";Fe(()=>{const X=t(x).map(pe=>pe.id).sort().join(","),fe=t(_).filter(pe=>pe.id.startsWith("conn_")).map(pe=>pe.id).sort().join(",");if(`${X}|${fe}`!==ie)return G&&clearTimeout(G),G=setTimeout(async()=>{const pe=await ee(t(r).id);if(c(j,pe,!0),pe){k(pe),z(pe);const Ne=t(x).map(et=>et.id).sort().join(","),Xe=t(_).filter(et=>et.id.startsWith("conn_")).map(et=>et.id).sort().join(",");ie=`${Ne}|${Xe}`,pe.validation_status==="errors"&&!t(l)&&t(h).status==="clean"?c(h,{status:"draft",lastSaved:t(h).lastSaved,error:`${pe.errors.length} error${pe.errors.length>1?"s":""}`,validationResult:pe},!0):pe.validation_status!=="errors"&&t(h).status==="draft"?c(h,{status:"clean",lastSaved:t(h).lastSaved,error:null,validationResult:pe},!0):c(h,{...t(h),validationResult:pe},!0)}},500),()=>{G&&clearTimeout(G)}});async function ee(X){try{const fe=zt(t(x)),_e={id:X,name:t(r).name,runtime_state:t(r).runtime_state,nodes:fe,connections:Et(t(_))};console.log("[runFlowValidation] Sending node IDs to validation:",fe.map(Xe=>Xe.id));const pe=await fetch(`/flowbuilder/flows/${X}/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)});return pe.ok?await pe.json():(console.error("Validation request failed:",pe.status,pe.statusText),null)}catch(fe){return console.error("Validation failed:",fe),null}}function z(X){if(c(_,t(_).filter(_e=>!_e.id.startsWith("auto_")),!0),!X.discovered_connections||X.discovered_connections.length===0)return;const fe=X.discovered_connections.map(_e=>{const Ne={id:`auto_${_e.source_node_id}_${_e.source_port}_${_e.target_node_id}_${_e.target_port}`,source_node_id:_e.source_node_id,source_port:_e.source_port,target_node_id:_e.target_node_id,target_port:_e.target_port,source:"auto",validationState:"valid"},Xe=St(Ne);return console.log("[updateAutoConnections] Created edge:",JSON.stringify(Xe,null,2)),Xe});console.log("[updateAutoConnections] Adding",fe.length,"auto edges to array"),console.log("[updateAutoConnections] Current node IDs:",t(x).map(_e=>_e.id)),console.log("[updateAutoConnections] Node ports:",JSON.stringify(t(x).map(_e=>({id:_e.id.substring(0,20),input_ports:_e.data.input_ports?.length||0,output_ports:_e.data.output_ports?.length||0})))),c(_,[...t(_),...fe],!0),console.log("[updateAutoConnections] Total edges after reassignment:",t(_).length)}function k(X){if(X.nodes&&X.nodes.length>0){const fe=t(x).map(_e=>{const pe=X.nodes.find(Ne=>Ne.id===_e.id);return pe?{..._e,data:{..._e.data,input_ports:pe.input_ports,output_ports:pe.output_ports}}:_e});c(x,fe,!0)}if(X.errors.length>0)for(let fe=0;fe<t(_).length;fe++){const _e=t(_)[fe];X.errors.some(Ne=>Ne.component_name===_e.source||Ne.component_name===_e.target)&&_e.data&&(t(_)[fe]={..._e,data:{..._e.data,validationState:"error"}})}}function D(X){const fe=`node_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,_e=400,pe=300,Ne=t(x).length%3*200,Xe=Math.floor(t(x).length/3)*150,et={id:fe,type:X.id,name:X.name,position:{x:_e+Ne,y:pe+Xe},config:{}},Vt=kt(et,P);c(x,[...t(x),Vt],!0),c(l,!0),c(h,{...t(h),status:"dirty"},!0)}function K(){c(v,null)}function re(X,fe){c(x,t(x).map(_e=>_e.id===X?{..._e,data:{..._e.data,node:{..._e.data.node,config:fe}}}:_e),!0),c(l,!0),c(h,{...t(h),status:"dirty"},!0)}let b=!1;async function f(){if(!b){b=!0,c(h,{...t(h),status:"saving"},!0);try{const X=await ee(t(r).id),fe=await Oo(t(r).id,{id:t(r).id,name:t(r).name,description:t(r).description,version:t(r).version,runtime_state:t(r).runtime_state,nodes:zt(t(x)),connections:Et(t(_))});c(r,{...t(r),version:fe.version,runtime_state:fe.runtime_state,updated_at:fe.updated_at},!0),c(l,!1),X?.validation_status==="errors"?c(h,{status:"draft",lastSaved:new Date,error:`${X.errors.length} error${X.errors.length>1?"s":""}`,validationResult:X},!0):c(h,{status:"clean",lastSaved:new Date,error:null,validationResult:X},!0),t(m).state!==fe.runtime_state&&c(m,{state:fe.runtime_state,message:null,lastTransition:new Date},!0),t(g)&&(c(g,!1),await T()),t(C)&&(c(C,!1),w?.allowNavigation())}catch(X){const fe=X instanceof Error?X.message:"Save failed";c(h,{...t(h),status:"error",error:fe},!0),c(g,!1),c(C,!1)}finally{b=!1}}}async function T(){if(t(j)?.validation_status==="errors"){c(S,!0);return}if(t(l)){c(g,!0),await f();return}try{const X=await Io(t(r).id);c(r,{...t(r),runtime_state:X.runtime_state,updated_at:X.updated_at},!0),c(m,{state:X.runtime_state,message:null,lastTransition:new Date},!0)}catch(X){if(Ho(X))c(A,X.validationResult,!0),c(F,!0),c(m,{...t(m),state:"not_deployed",message:null},!0);else{const fe=X instanceof Error?X.message:"Deploy failed";c(m,{...t(m),state:"error",message:fe},!0)}}}async function I(){try{const X=await Po(t(r).id);c(r,{...t(r),runtime_state:X.runtime_state,updated_at:X.updated_at},!0),c(m,{state:X.runtime_state,message:null,lastTransition:new Date},!0)}catch(X){const fe=X instanceof Error?X.message:"Start failed";c(m,{...t(m),state:"error",message:fe},!0)}}async function N(){try{const X=await Ao(t(r).id);c(r,{...t(r),runtime_state:X.runtime_state,updated_at:X.updated_at},!0),c(m,{state:X.runtime_state,message:null,lastTransition:new Date},!0)}catch(X){const fe=X instanceof Error?X.message:"Stop failed";c(m,{...t(m),state:"error",message:fe},!0)}}async function Z(){c(C,!0),await f()}function $(){w?.allowNavigation()}function ce(){w?.cancelNavigation()}function Q(){c(F,!1),c(A,null)}function p(){c(S,!1)}function W(){c(u,!0)}function te(){c(u,!1)}function ae(){c(E,!t(E))}function se(){c(E,!1)}const ve=70,ge=50,B=U(()=>t(E)?`calc(100vh - ${ve}px - ${ge}px - ${q}px)`:`calc(100vh - ${ve}px - ${ge}px)`);var le=Lo();Qt(X=>{V(()=>$t.title=`${(t(r)?.name||"Flow Editor")??""} - SemStreams`)});var ne=ue(le);$e(Wn(ne,{get saveState(){return t(h)},get showDialog(){return t(y)},set showDialog(X){c(y,X,!0)}}),X=>w=X,()=>w);var de=n(ne,2);Kn(de,{get isOpen(){return t(y)},onSave:Z,onDiscard:$,onCancel:ce});var me=n(de,2);co(me,{get isOpen(){return t(F)},get validationResult(){return t(A)},onClose:Q});var ye=n(me,2);bo(ye,{get isOpen(){return t(S)},get validationResult(){return t(j)},onClose:p});var xe=n(ye,2);Mo(xe,{get isOpen(){return t(u)},get validationResult(){return t(j)},onClose:te});var Re=n(xe,2),Ce=s(Re),He=s(Ce);sr(He,{onAddComponent:D}),a(Ce);var De=n(Ce,2),qe=s(De),Pe=s(qe),je=n(s(Pe),2),Me=s(je),Ae=s(Me,!0);a(Me);var Be=n(Me,2);{var vt=X=>{var fe=No(),_e=s(fe,!0);a(fe),V(()=>R(_e,t(r).description)),i(X,fe)};M(Be,X=>{t(r)?.description&&X(vt)})}a(je);var rt=n(je,2);Un(rt,{get saveState(){return t(h)},onSave:f,get validationResult(){return t(j)},onValidationClick:W}),a(Pe),a(qe);var Je=n(qe,2),st=s(Je);Ka(st,{onNodeClick:P,onConnectionCreate:()=>{c(l,!0),c(h,{...t(h),status:"dirty"},!0)},get runtimeState(){return t(r).runtime_state},get nodes(){return t(x)},set nodes(X){c(x,X,!0)},get edges(){return t(_)},set edges(X){c(_,X,!0)}}),a(Je);var Ie=n(Je,2);Fs(Ie,{get runtimeState(){return t(m)},get isFlowValid(){return t(H)},get showRuntimePanel(){return t(E)},onDeploy:T,onStart:I,onStop:N,onToggleRuntimePanel:ae});var Oe=n(Ie,2);Mn(Oe,{get isOpen(){return t(E)},height:q,get flowId(){return t(r).id},onClose:se}),a(De);var Ve=n(De,2);{var Ue=X=>{var fe=Vo(),_e=s(fe);hs(_e,{get component(){return t(v)},onSave:re,onClose:K}),a(fe),i(X,fe)};M(Ve,X=>{t(v)&&X(Ue)})}a(Re),V(()=>{R(Ae,t(r)?.name||"Loading..."),Le(Je,`height: ${t(B)??""};`)}),i(o,le),ke()}export{el as component,$o as universal};
