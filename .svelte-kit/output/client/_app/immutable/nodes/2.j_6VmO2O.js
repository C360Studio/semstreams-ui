import{i as I,g as N,c as L}from"../chunks/DWg6l2ov.js";import"../chunks/DsnmJJEf.js";import{aB as V,Y as O,P as f,T as i,R as u,Z as P,V as l,W as n,d as c,Q as C,X as y,aQ as z,a9 as J,aU as Q,O as A,S as B,aV as R}from"../chunks/DyRE0cBX.js";import{i as T}from"../chunks/dEYrHuzZ.js";import{g as M}from"../chunks/cw9Ti4I1.js";import{e as W}from"../chunks/BN3MZzqc.js";import{s as X}from"../chunks/DR4KUQce.js";const Y=async({fetch:t})=>{try{const e=await t("/flowbuilder/flows");if(!e.ok)throw e.headers.get("content-type")?.includes("text/html")?new Error("Backend service unavailable (received HTML error page)"):new Error(`Failed to load flows: ${e.statusText}`);return{flows:(await e.json()).flows||[]}}catch(e){console.error("Failed to load flows:",e);let a;return I(e)?a="Cannot connect to backend service":a=N(e),{flows:[],error:a}}},he=Object.freeze(Object.defineProperty({__proto__:null,load:Y},Symbol.toStringTag,{value:"Module"}));var Z=(t,e)=>e.onCreate?.(),q=f('<div class="empty-state svelte-fcx454"><p>No flows yet. Create your first flow to get started.</p></div>'),G=(t,e,a)=>e.onFlowClick?.(c(a).id),K=f('<p class="description svelte-fcx454"> </p>'),ee=f('<button class="flow-card svelte-fcx454"><h3 class="svelte-fcx454"> </h3> <!> <span> </span></button>'),te=f('<div class="flow-grid svelte-fcx454"></div>'),ae=f('<div class="flow-list svelte-fcx454"><header class="svelte-fcx454"><h2>Flows</h2> <button aria-label="Create New Flow">Create New Flow</button></header> <!></div>');function se(t,e){O(e,!0);var a=ae(),o=l(a),p=i(l(o),2);p.__click=[Z,e],n(o);var E=i(o,2);{var g=d=>{var v=q();u(d,v)},x=d=>{var v=te();W(v,21,()=>e.flows,m=>m.id,(m,w)=>{var s=ee();s.__click=[G,e,w];var r=l(s),h=l(r,!0);n(r);var b=i(r,2);{var H=S=>{var $=K(),D=l($,!0);n($),C(()=>y(D,c(w).description)),u(S,$)};T(b,S=>{c(w).description&&S(H)})}var j=i(b,2),U=l(j,!0);n(j),n(s),C(()=>{y(h,c(w).name),X(j,1,`runtime-state ${c(w).runtime_state??""}`,"svelte-fcx454"),y(U,c(w).runtime_state)}),u(m,s)}),n(v),u(d,v)};T(E,d=>{e.flows.length===0?d(g):d(x,!1)})}n(a),u(t,a),P()}V(["click"]);const _="/flowbuilder/flows";class F extends Error{constructor(e,a,o){super(e),this.statusCode=a,this.details=o,this.name="FlowApiError"}}function k(t){return{...t,nodes:t.nodes||[],connections:t.connections||[],runtime_state:t.runtime_state}}const oe={async createFlow(t){const e=await fetch(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const o=await e.json().catch(()=>({}));throw new F(`Failed to create flow: ${e.statusText}`,e.status,o)}const a=await e.json();return k(a)},async listFlows(){const t=await fetch(_);if(!t.ok)throw new F(`Failed to list flows: ${t.statusText}`,t.status);return(await t.json()).flows.map(k)},async getFlow(t){const e=await fetch(`${_}/${t}`);if(!e.ok)throw new F(`Failed to get flow: ${e.statusText}`,e.status);const a=await e.json();return k(a)},async updateFlow(t,e){const a=await fetch(`${_}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){const p=await a.json().catch(()=>({}));throw new F(`Failed to update flow: ${a.statusText}`,a.status,p)}const o=await a.json();return k(o)},async deleteFlow(t){const e=await fetch(`${_}/${t}`,{method:"DELETE"});if(!e.ok)throw new F(`Failed to delete flow: ${e.statusText}`,e.status)}};var re=f('<div class="connectivity-banner svelte-1uha8ag"><strong class="svelte-1uha8ag">⚠️ Backend Not Available</strong> <p class="svelte-1uha8ag"> </p> <p class="help-text svelte-1uha8ag">Please ensure your backend service is running. Check the README for setup instructions.</p></div>'),ne=f('<div class="error-banner svelte-1uha8ag"><strong class="svelte-1uha8ag">Error:</strong> </div>'),le=f('<main class="svelte-1uha8ag"><div class="page-header svelte-1uha8ag"><h1 class="svelte-1uha8ag">Visual Flow Builder</h1> <p class="svelte-1uha8ag">Create and manage semantic stream processing flows</p></div> <!> <!> <!></main>');function pe(t,e){O(e,!0);let a=B(null),o=B("");z(async()=>{const s=await L();A(a,s.healthy,!0),A(o,s.message,!0)});async function p(){try{const s=await oe.createFlow({name:`Flow ${new Date().toISOString()}`,description:"New flow created from UI"});await M(`/flows/${s.id}`)}catch(s){console.error("Failed to create flow:",s);const r=N(s);alert(`Failed to create flow: ${r}`)}}function E(s){M(`/flows/${s}`)}var g=le();J(s=>{Q.title="SemStreams - Flow Builder"});var x=i(l(g),2);{var d=s=>{var r=re(),h=i(l(r),2),b=l(h,!0);n(h),R(2),n(r),C(()=>y(b,c(o))),u(s,r)};T(x,s=>{c(a)===!1&&s(d)})}var v=i(x,2);{var m=s=>{var r=ne(),h=i(l(r));n(r),C(()=>y(h,` ${e.data.error??""}`)),u(s,r)};T(v,s=>{e.data.error&&c(a)!==!1&&s(m)})}var w=i(v,2);se(w,{get flows(){return e.data.flows},onCreate:p,onFlowClick:E}),n(g),u(t,g),P()}export{pe as component,he as universal};
